<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§ˆì´í™ˆ ë°°ì¹˜ í…ŒìŠ¤íŠ¸</title>
    <style>
        :root { --accent: #ff9c00; --bg: #111; }
        body { background: var(--bg); color: white; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; margin: 0; }
        
        /* ì•„ì´í…œ ìƒì  */
        .shop { background: #222; padding: 15px; border-radius: 12px; display: flex; gap: 15px; margin-bottom: 20px; border: 1px solid #333; }
        .shop-item { width: 50px; height: 50px; cursor: pointer; border-radius: 8px; transition: 0.2s; background: #000; border: 1px solid #444; padding: 5px; }
        .shop-item:hover { transform: scale(1.1); border-color: var(--accent); }

        /* ë§ˆì´í™ˆ ìº”ë²„ìŠ¤ */
        #room-canvas { 
            position: relative; 
            width: 350px; 
            height: 450px; 
            background: #1a1a1a; 
            background-image: linear-gradient(#222 1px, transparent 1px), linear-gradient(90deg, #222 1px, transparent 1px);
            background-size: 20px 20px; /* ê²©ì ë¬´ëŠ¬ */
            border: 3px solid #333; 
            border-radius: 20px; 
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        /* ë°°ì¹˜ëœ ì•„ì´í…œ */
        .placed-item { 
            position: absolute; 
            width: 60px; 
            height: 60px; 
            cursor: move; 
            touch-action: none; /* ëª¨ë°”ì¼ ìŠ¤í¬ë¡¤ ë°©ì§€ */
            user-select: none;
            filter: drop-shadow(0 5px 5px rgba(0,0,0,0.5));
        }
        .placed-item.dragging { opacity: 0.7; transform: scale(1.1); z-index: 1000; }

        .controls { margin-top: 20px; display: flex; gap: 10px; }
        button { padding: 10px 20px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; }
        .btn-save { background: var(--accent); color: black; }
        .btn-reset { background: #444; color: white; }
    </style>
</head>
<body>

    <h2 style="color:var(--accent);">ğŸ  ìš”ì›ì‹¤ ë°°ì¹˜ í…ŒìŠ¤íŠ¸</h2>
    <p style="font-size: 12px; color: #888;">ì•„ì´ì½˜ì„ í´ë¦­í•˜ì—¬ ì¶”ê°€í•˜ê³ , ë“œë˜ê·¸í•´ì„œ ë°°ì¹˜í•˜ì„¸ìš”.</p>

    <div class="shop">
        <img src="https://cdn-icons-png.flaticon.com/512/287/287221.png" class="shop-item" onclick="addItem('hero1', this.src)" title="ìºë¦­í„°1">
        <img src="https://cdn-icons-png.flaticon.com/512/287/287226.png" class="shop-item" onclick="addItem('hero2', this.src)" title="ìºë¦­í„°2">
        <img src="https://cdn-icons-png.flaticon.com/512/963/963864.png" class="shop-item" onclick="addItem('pc', this.src)" title="ì»´í“¨í„°">
        <img src="https://cdn-icons-png.flaticon.com/512/3016/3016832.png" class="shop-item" onclick="addItem('sofa', this.src)" title="ì†ŒíŒŒ">
    </div>

    <div id="room-canvas"></div>

    <div class="controls">
        <button class="btn-reset" onclick="resetRoom()">ì´ˆê¸°í™”</button>
        <button class="btn-save" onclick="saveData()">ì €ì¥í•˜ê¸°</button>
    </div>

    <script>
        let placedItems = [];
        const canvas = document.getElementById('room-canvas');

        // 1. ì•„ì´í…œ ì¶”ê°€
        function addItem(type, src) {
            const id = 'item_' + Date.now();
            const itemObj = { id, src, x: 20, y: 20 }; // ì´ˆê¸° ìœ„ì¹˜
            placedItems.push(itemObj);
            renderItem(itemObj);
        }

        // 2. í™”ë©´ì— ì•„ì´í…œ ìƒì„±
        function renderItem(itemObj) {
            const img = document.createElement('img');
            img.src = itemObj.src;
            img.className = 'placed-item';
            img.id = itemObj.id;
            img.style.left = itemObj.x + 'px';
            img.style.top = itemObj.y + 'px';

            // ë§ˆìš°ìŠ¤/í„°ì¹˜ ì´ë²¤íŠ¸ ì—°ê²°
            img.onmousedown = (e) => handleDrag(e, itemObj, img);
            img.ontouchstart = (e) => handleDrag(e, itemObj, img);
            
            // ë”ë¸” í´ë¦­ ì‹œ ì‚­ì œ
            img.ondblclick = () => removeItem(itemObj.id);

            canvas.appendChild(img);
        }

        // 3. ë“œë˜ê·¸ ë¡œì§ (í•µì‹¬)
        function handleDrag(e, data, el) {
            e.preventDefault();
            el.classList.add('dragging');

            const isTouch = e.type === 'touchstart';
            const moveEvent = isTouch ? 'touchmove' : 'mousemove';
            const upEvent = isTouch ? 'touchend' : 'mouseup';
            
            const startX = isTouch ? e.touches[0].clientX : e.clientX;
            const startY = isTouch ? e.touches[0].clientY : e.clientY;
            
            const initialLeft = parseInt(el.style.left);
            const initialTop = parseInt(el.style.top);

            function onMove(me) {
                const curX = isTouch ? me.touches[0].clientX : me.clientX;
                const curY = isTouch ? me.touches[0].clientY : me.clientY;

                const dx = curX - startX;
                const dy = curY - startY;

                let newX = initialLeft + dx;
                let newY = initialTop + dy;

                // ìº”ë²„ìŠ¤ ë°–ìœ¼ë¡œ ë‚˜ê°€ì§€ ì•Šê²Œ ì œí•œ
                const rect = canvas.getBoundingClientRect();
                newX = Math.max(0, Math.min(newX, rect.width - 60));
                newY = Math.max(0, Math.min(newY, rect.height - 60));

                el.style.left = newX + 'px';
                el.style.top = newY + 'px';
                data.x = newX;
                data.y = newY;
            }

            function onUp() {
                el.classList.remove('dragging');
                document.removeEventListener(moveEvent, onMove);
                document.removeEventListener(upEvent, onUp);
            }

            document.addEventListener(moveEvent, onMove);
            document.addEventListener(upEvent, onUp);
        }

        // 4. ì‚­ì œ ë° ì´ˆê¸°í™”
        function removeItem(id) {
            placedItems = placedItems.filter(i => i.id !== id);
            document.getElementById(id).remove();
        }

        function resetRoom() {
            if(confirm("ë°©ì„ ë¹„ìš°ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                canvas.innerHTML = '';
                placedItems = [];
            }
        }

        // 5. ì €ì¥ (í…ŒìŠ¤íŠ¸ìš© ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì‚¬ìš©)
        function saveData() {
            localStorage.setItem('test_room_save', JSON.stringify(placedItems));
            alert("ë°°ì¹˜ê°€ ë¡œì»¬ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\nì•„ì´í…œ ìˆ˜: " + placedItems.length);
        }

        // 6. í˜ì´ì§€ ë¡œë“œ ì‹œ ë¶ˆëŸ¬ì˜¤ê¸°
        window.onload = () => {
            const saved = localStorage.getItem('test_room_save');
            if(saved) {
                placedItems = JSON.parse(saved);
                placedItems.forEach(renderItem);
            }
        };
    </script>
</body>
</html>
