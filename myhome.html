<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë§ˆì´í™ˆ - ëª¨ë°”ì¼ ìµœì í™”</title>
    <style>
        :root { --bg-color: #111; --wall-l: #2a2a2a; --wall-r: #333; --floor: #1e1e1e; }
        
        body {
            background-color: black;
            color: white;
            font-family: sans-serif;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            /* ëª¨ë°”ì¼ì—ì„œ ë‹¹ê²¨ì„œ ìƒˆë¡œê³ ì¹¨ ë˜ëŠ” ê²ƒ ë°©ì§€ */
            overscroll-behavior: none; 
        }

        /* 1. ìƒì  UI */
        .shop-container {
            width: 100%;
            max-width: 500px;
            background: #222;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-sizing: border-box;
            border: 1px solid #333;
        }

        .tab-menu { display: flex; gap: 10px; margin-bottom: 15px; }
        .tab { 
            padding: 5px 12px; font-size: 14px; color: #888; cursor: pointer; border-radius: 20px; background: #1a1a1a;
        }
        .tab.active { background: #ff9c00; color: black; font-weight: bold; }

        .item-scroll { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px; }
        .shop-item { 
            width: 50px; height: 50px; flex-shrink: 0; background: #000; border-radius: 8px; border: 1px solid #444; padding: 5px; 
        }

        /* 2. ë°© ë·°í¬íŠ¸ (ì—¬ê¸°ê°€ í•µì‹¬) */
        .room-viewport {
            position: relative;
            width: 100%;
            max-width: 500px; /* PCì—ì„œëŠ” ë„ˆë¬´ ì»¤ì§€ì§€ ì•Šê²Œ */
            aspect-ratio: 1 / 0.8; /* ì •ì‚¬ê°í˜•ì— ê°€ê¹Œìš´ ë¹„ìœ¨ ìœ ì§€ */
            background: #000;
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid #333;
            /* í„°ì¹˜ ì‹œ ë¸Œë¼ìš°ì € ìŠ¤í¬ë¡¤ ë°©ì§€ (ë§¤ìš° ì¤‘ìš”) */
            touch-action: none; 
        }

        /* 3. ì ˆëŒ€ ê¹¨ì§€ì§€ ì•ŠëŠ” 'ì¤‘ì•™ ì•µì»¤' ì‹œìŠ¤í…œ 
           ëª¨ë“  ë²½ê³¼ ë°”ë‹¥ì€ ì´ ì (Center Anchor)ì„ ê¸°ì¤€ìœ¼ë¡œ ê·¸ë ¤ì§‘ë‹ˆë‹¤.
        */
        .center-anchor {
            position: absolute;
            top: 45%; /* ë°©ì˜ ê¼­ì§“ì  ë†’ì´ */
            left: 50%; /* ë°©ì˜ ê°€ë¡œ ì¤‘ì•™ */
            width: 0; height: 0;
        }

        /* ì™¼ìª½ ë²½ */
        .wall-left {
            position: absolute;
            bottom: 0; right: 0; /* ì•µì»¤ ê¸°ì¤€ ì™¼ìª½ ì•„ë˜ */
            width: 300px; height: 400px; /* ì¶©ë¶„íˆ í¬ê²Œ */
            background: var(--wall-l);
            transform-origin: bottom right;
            transform: skewY(26.5deg);
            border-right: 1px solid #000;
        }

        /* ì˜¤ë¥¸ìª½ ë²½ */
        .wall-right {
            position: absolute;
            bottom: 0; left: 0; /* ì•µì»¤ ê¸°ì¤€ ì˜¤ë¥¸ìª½ ì•„ë˜ */
            width: 300px; height: 400px;
            background: var(--wall-r);
            transform-origin: bottom left;
            transform: skewY(-26.5deg);
        }

        /* ë°”ë‹¥ */
        .floor {
            position: absolute;
            top: 0; left: 0; /* ì•µì»¤ ê¸°ì¤€ ë°”ë¡œ ì•„ë˜ ì‹œì‘ */
            width: 400px; height: 400px;
            background: var(--floor);
            /* ë°”ë‹¥ ê²©ì ë¬´ëŠ¬ */
            background-image: 
                linear-gradient(rgba(255,255,255,0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.05) 1px, transparent 1px);
            background-size: 40px 40px;
            /* ë§ˆë¦„ëª¨ ê¼´ë¡œ ë³€í˜• (ê°€ì¥ ì•ˆì •ì ì¸ ë°©ì‹) */
            transform-origin: top left;
            transform: rotate(-45deg) skew(15deg, 15deg) scale(0.7); 
            border: 1px solid #333;
        }

        /* ë°°ì¹˜ëœ ì•„ì´í…œ */
        .placed-item {
            position: absolute;
            width: 70px; /* ê¸°ë³¸ í¬ê¸° */
            z-index: 100;
            filter: drop-shadow(0 5px 5px rgba(0,0,0,0.5));
            
            /* ëª¨ë°”ì¼ ë“œë˜ê·¸ í•„ìˆ˜ ì„¤ì • */
            touch-action: none; 
            user-select: none;
            -webkit-user-select: none;
        }
    </style>
</head>
<body>

    <h3 style="margin-top:0; color:#ff9c00">ğŸ› ï¸ ìš”ì›ì‹¤ (ëª¨ë°”ì¼ íŒ¨ì¹˜ë²„ì „)</h3>
    
    <div class="shop-container">
        <div class="tab-menu">
            <div class="tab active" onclick="setMode('furniture')">ê°€êµ¬</div>
            <div class="tab" onclick="setMode('wall')">ë²½ì§€</div>
        </div>
        
        <div id="shop-furniture" class="item-scroll">
            <img src="https://cdn-icons-png.flaticon.com/512/963/963864.png" class="shop-item" onclick="spawnItem(this.src)">
            <img src="https://cdn-icons-png.flaticon.com/512/3016/3016832.png" class="shop-item" onclick="spawnItem(this.src)">
            <img src="https://cdn-icons-png.flaticon.com/512/2311/2311453.png" class="shop-item" onclick="spawnItem(this.src)">
            <img src="https://cdn-icons-png.flaticon.com/512/1674/1674291.png" class="shop-item" onclick="spawnItem(this.src)">
        </div>

        <div id="shop-wall" class="item-scroll" style="display:none;">
            <div class="shop-item" style="background:#2a2a2a" onclick="setWallColor('#2a2a2a', '#333')"></div>
            <div class="shop-item" style="background:#2c3e50" onclick="setWallColor('#2c3e50', '#34495e')"></div>
            <div class="shop-item" style="background:#5d4037" onclick="setWallColor('#5d4037', '#795548')"></div>
            <div class="shop-item" style="background:#2e7d32" onclick="setWallColor('#2e7d32', '#388e3c')"></div>
        </div>
    </div>

    <div class="room-viewport" id="canvas">
        <div class="center-anchor">
            <div class="floor"></div>
            <div class="wall-left" id="w-left"></div>
            <div class="wall-right" id="w-right"></div>
        </div>
        </div>

    <p style="font-size:12px; color:#666;">* í„°ì¹˜í•˜ì—¬ ë“œë˜ê·¸, ë”ë¸” í„°ì¹˜ë¡œ ì‚­ì œ</p>
    <button onclick="savePos()" style="background:#ff9c00; border:none; padding:10px 30px; border-radius:20px; font-weight:bold;">ë°°ì¹˜ ì €ì¥í•˜ê¸°</button>

    <script>
        const canvas = document.getElementById('canvas');
        const SNAP = 10; // ìì„ íš¨ê³¼ ê°ë„

        // íƒ­ ë³€ê²½
        function setMode(mode) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            document.getElementById('shop-furniture').style.display = mode === 'furniture' ? 'flex' : 'none';
            document.getElementById('shop-wall').style.display = mode === 'wall' ? 'flex' : 'none';
        }

        // ë²½ì§€ ë³€ê²½
        function setWallColor(c1, c2) {
            document.querySelector(':root').style.setProperty('--wall-l', c1);
            document.querySelector(':root').style.setProperty('--wall-r', c2);
        }

        // ì•„ì´í…œ ìƒì„±
        function spawnItem(src) {
            const img = document.createElement('img');
            img.src = src;
            img.className = 'placed-item';
            
            // í™”ë©´ ì¤‘ì•™ì¯¤ì— ë°°ì¹˜
            img.style.left = (canvas.clientWidth / 2 - 35) + 'px';
            img.style.top = (canvas.clientHeight / 2) + 'px';

            // ì´ë²¤íŠ¸ ì—°ê²° (ëª¨ë°”ì¼ & PC)
            addDragEvent(img);
            
            // ë”ë¸”í´ë¦­ ì‚­ì œ
            let lastTap = 0;
            img.addEventListener('touchend', function (e) {
                const currentTime = new Date().getTime();
                const tapLength = currentTime - lastTap;
                if (tapLength < 300 && tapLength > 0) {
                    img.remove();
                    e.preventDefault();
                }
                lastTap = currentTime;
            });
            img.ondblclick = () => img.remove();

            canvas.appendChild(img);
        }

        // í•µì‹¬: ë“œë˜ê·¸ ë¡œì§ (ëª¨ë°”ì¼ í˜¸í™˜)
        function addDragEvent(el) {
            let startX, startY, initLeft, initTop;

            function start(e) {
                // í„°ì¹˜ ì´ë²¤íŠ¸ì¸ ê²½ìš° e.touches[0] ì‚¬ìš©
                const point = e.touches ? e.touches[0] : e;
                startX = point.clientX;
                startY = point.clientY;
                initLeft = el.offsetLeft;
                initTop = el.offsetTop;

                // ë“œë˜ê·¸ ì¤‘ ìŠ¤í¬ë¡¤ ë°©ì§€
                if(e.cancelable) e.preventDefault();

                document.addEventListener('mousemove', move);
                document.addEventListener('mouseup', end);
                document.addEventListener('touchmove', move, { passive: false });
                document.addEventListener('touchend', end);
            }

            function move(e) {
                const point = e.touches ? e.touches[0] : e;
                const dx = point.clientX - startX;
                const dy = point.clientY - startY;

                let nextLeft = initLeft + dx;
                let nextTop = initTop + dy;

                // ìº”ë²„ìŠ¤ ë°–ìœ¼ë¡œ ëª» ë‚˜ê°€ê²Œ ì œí•œ
                const maxW = canvas.clientWidth - el.clientWidth;
                const maxH = canvas.clientHeight - el.clientHeight;
                
                nextLeft = Math.max(0, Math.min(nextLeft, maxW));
                nextTop = Math.max(0, Math.min(nextTop, maxH));

                // ìŠ¤ëƒ…í•‘ (ì„ íƒì‚¬í•­)
                // nextLeft = Math.round(nextLeft / SNAP) * SNAP;
                // nextTop = Math.round(nextTop / SNAP) * SNAP;

                el.style.left = nextLeft + 'px';
                el.style.top = nextTop + 'px';
                
                // ê¹Šì´ íš¨ê³¼ (ì•„ë˜ë¡œ ê°ˆìˆ˜ë¡ ì•ìœ¼ë¡œ íŠ€ì–´ë‚˜ì˜´)
                el.style.zIndex = Math.floor(nextTop);
                
                if(e.cancelable) e.preventDefault(); // ì¤‘ìš”: ëª¨ë°”ì¼ ìŠ¤í¬ë¡¤ ë§‰ê¸°
            }

            function end() {
                document.removeEventListener('mousemove', move);
                document.removeEventListener('mouseup', end);
                document.removeEventListener('touchmove', move);
                document.removeEventListener('touchend', end);
            }

            el.addEventListener('mousedown', start);
            el.addEventListener('touchstart', start, { passive: false });
        }

        function savePos() {
            alert("ì¢Œí‘œ ì €ì¥ ì™„ë£Œ (ì½˜ì†” í™•ì¸)");
            // ì‹¤ì œ êµ¬í˜„ ì‹œ placedItems ë°°ì—´ì„ ë§Œë“¤ì–´ ì €ì¥
        }
    </script>
</body>
</html>
