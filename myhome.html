<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>My Home</title>

<style>
  body {
    margin:0;
    background:#1e1e1e;
    color:white;
    font-family: monospace;
    display:flex;
    height:100vh;
    overflow:hidden;
  }

  #ui {
    width:140px;
    background:#111;
    padding:8px;
    box-sizing:border-box;
  }

  button {
    width:100%;
    margin-bottom:6px;
    padding:6px;
    font-size:12px;
  }

  canvas {
    flex:1;
    background:#2a2a2a;
    image-rendering: pixelated;
    touch-action:none;
  }
</style>
</head>
<body>

<div id="ui">
  <b>ğŸ  ë°°ì¹˜</b>
  <button onclick="select('chair')">ì˜ì</button>
  <button onclick="select('table')">í…Œì´ë¸”</button>
  <button onclick="select('plant')">í™”ë¶„</button>
  <button onclick="select('character')">ìºë¦­í„°</button>
  <hr>
  <button onclick="select(null)">âŒ ì„ íƒ í•´ì œ</button>
</div>

<canvas id="c"></canvas>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

function resize() {
  canvas.width = window.innerWidth - 140;
  canvas.height = window.innerHeight;
}
resize();
window.addEventListener("resize", resize);

// ===== ì„¤ì • =====
const TILE_W = 64;
const TILE_H = 32;
const MAP_W = 7;
const MAP_H = 7;

// ìƒ‰ìƒ = ì„ì‹œ 16ë¹„íŠ¸ ì• ì…‹
const colors = {
  floor: "#555",
  wall: "#888",
  chair: "#c96",
  table: "#9c6",
  plant: "#6c9",
  character: "#6cf"
};

let selected = null;
let dragging = null;

// ë°°ì¹˜ëœ ì˜¤ë¸Œì íŠ¸
const objects = [];

// ===== ì¢Œí‘œ ë³€í™˜ =====
function iso(x, y) {
  return {
    x: (x - y) * TILE_W / 2 + canvas.width / 2,
    y: (x + y) * TILE_H / 2 + 100
  };
}

// ===== ë°”ë‹¥ =====
function drawFloor() {
  for (let y=0;y<MAP_H;y++) {
    for (let x=0;x<MAP_W;x++) {
      const p = iso(x,y);
      ctx.fillStyle = colors.floor;
      ctx.beginPath();
      ctx.moveTo(p.x, p.y);
      ctx.lineTo(p.x + TILE_W/2, p.y + TILE_H/2);
      ctx.lineTo(p.x, p.y + TILE_H);
      ctx.lineTo(p.x - TILE_W/2, p.y + TILE_H/2);
      ctx.closePath();
      ctx.fill();
    }
  }
}

// ===== ë²½ =====
function drawWalls() {
  for (let x=0;x<MAP_W;x++) {
    const p = iso(x,0);
    ctx.fillStyle = colors.wall;
    ctx.fillRect(p.x - 4, p.y - 40, 8, 40);
  }
  for (let y=0;y<MAP_H;y++) {
    const p = iso(0,y);
    ctx.fillStyle = colors.wall;
    ctx.fillRect(p.x - 30, p.y - 20, 30, 8);
  }
}

// ===== ì˜¤ë¸Œì íŠ¸ =====
function drawObjects() {
  objects
    .sort((a,b)=> (a.y - b.y))
    .forEach(o=>{
      const p = iso(o.x,o.y);
      ctx.fillStyle = colors[o.type];
      ctx.fillRect(p.x - 10, p.y + 4, 20, 20);
    });
}

// ===== ë Œë” =====
function render() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawFloor();
  drawWalls();
  drawObjects();
}
render();

// ===== UI =====
function select(t) {
  selected = t;
}

// ===== ë“œë˜ê·¸ & í„°ì¹˜ =====
function getPos(e) {
  const r = canvas.getBoundingClientRect();
  const t = e.touches ? e.touches[0] : e;
  return {
    x: t.clientX - r.left,
    y: t.clientY - r.top
  };
}

function pickObject(mx,my) {
  for (let o of objects) {
    const p = iso(o.x,o.y);
    if (
      mx > p.x-10 && mx < p.x+10 &&
      my > p.y && my < p.y+24
    ) return o;
  }
  return null;
}

function gridFromScreen(mx,my) {
  const dx = mx - canvas.width/2;
  const dy = my - 100;
  const x = Math.floor((dy / TILE_H + dx / TILE_W));
  const y = Math.floor((dy / TILE_H - dx / TILE_W));
  return {x,y};
}

canvas.addEventListener("pointerdown", e=>{
  const p = getPos(e);
  dragging = pickObject(p.x,p.y);

  if (!dragging && selected) {
    const g = gridFromScreen(p.x,p.y);
    if (g.x>=0 && g.y>=0 && g.x<MAP_W && g.y<MAP_H) {
      objects.push({ ...g, type:selected });
      render();
    }
  }
});

canvas.addEventListener("pointermove", e=>{
  if (!dragging) return;
  const p = getPos(e);
  const g = gridFromScreen(p.x,p.y);
  dragging.x = Math.max(0,Math.min(MAP_W-1,g.x));
  dragging.y = Math.max(0,Math.min(MAP_H-1,g.y));
  render();
});

canvas.addEventListener("pointerup", ()=> dragging=null);
canvas.addEventListener("pointerleave", ()=> dragging=null);
</script>

</body>
</html>
