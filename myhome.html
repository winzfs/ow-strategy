<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì•„ì´ì†Œë©”íŠ¸ë¦­ ë§ˆì´í™ˆ - ì‹¬í™” ë²„ì „</title>
    <style>
        :root { --accent: #ff9c00; --bg: #0a0a0a; --grid: 20px; }
        body { background: var(--bg); color: white; font-family: 'Pretendard', sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; margin: 0; }

        /* ìƒì  ë° ì¹´í…Œê³ ë¦¬ */
        .shop-container { background: #1a1a1a; padding: 15px; border-radius: 15px; width: 600px; border: 1px solid #333; margin-bottom: 20px; }
        .tabs { display: flex; gap: 10px; margin-bottom: 10px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        .tab { cursor: pointer; font-size: 13px; color: #888; padding: 5px 10px; border-radius: 5px; }
        .tab.active { color: var(--accent); background: #333; font-weight: bold; }
        .item-list { display: flex; gap: 12px; overflow-x: auto; padding: 5px; }
        .shop-item { width: 50px; height: 50px; cursor: pointer; transition: 0.2s; background: #000; border-radius: 8px; padding: 5px; border: 1px solid #444; flex-shrink: 0; }
        .shop-item:hover { border-color: var(--accent); transform: scale(1.1); }

        /* ë©”ì¸ ë£¸ ì»¨í…Œì´ë„ˆ */
        .room-viewport {
            position: relative;
            width: 600px;
            height: 500px;
            background: #111;
            border-radius: 20px;
            overflow: hidden;
            border: 4px solid #222;
            box-shadow: 0 20px 50px rgba(0,0,0,0.8);
        }

        /* ì•„ì´ì†Œë©”íŠ¸ë¦­ ë² ì´ìŠ¤ (íšŒì „ ì¤‘ì‹¬) */
        .iso-base {
            position: absolute;
            top: 55%;
            left: 50%;
            transform: translate(-50%, -50%) rotateX(60deg) rotateZ(45deg);
            transform-style: preserve-3d;
        }

        /* ë°”ë‹¥ */
        #floor {
            width: 400px;
            height: 400px;
            background: #1e1e1e;
            background-image: linear-gradient(#2a2a2a 1px, transparent 1px), linear-gradient(90deg, #2a2a2a 1px, transparent 1px);
            background-size: 40px 40px; /* ìŠ¤ëƒ… ë‹¨ìœ„ */
            border: 2px solid #333;
        }

        /* ë²½ë©´ (Lìí˜•) */
        .wall { position: absolute; background: #2a2a2a; border: 1px solid #333; transition: background 0.3s; }
        .wall-left { width: 400px; height: 200px; transform: rotateX(-90deg) translateZ(-200px); top: -200px; transform-origin: bottom; }
        .wall-right { width: 200px; height: 400px; transform: rotateY(-90deg) translateZ(0); left: 400px; transform-origin: left; }

        /* ì•„ì´í…œ ë ˆì´ì–´ (ê¸°ìš¸ê¸° ì—­íšŒì „) */
        .item-layer {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            transform: rotateZ(-45deg) rotateX(-60deg); /* ë°”ë‹¥ íšŒì „ì˜ ë°˜ëŒ€ */
            pointer-events: none;
        }

        .placed-item {
            position: absolute;
            width: 80px;
            pointer-events: auto;
            cursor: move;
            user-select: none;
            filter: drop-shadow(0 10px 10px rgba(0,0,0,0.3));
        }
        .placed-item.dragging { opacity: 0.8; filter: brightness(1.2); z-index: 10000 !important; }

        .controls { margin-top: 20px; display: flex; gap: 10px; }
        button { padding: 10px 25px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; }
        .btn-save { background: var(--accent); color: black; }
    </style>
</head>
<body>

    <h2 style="color:var(--accent); margin-bottom: 5px;">ğŸ•¹ï¸ ìš”ì›ì‹¤ ì»¤ìŠ¤í…€ (Beta)</h2>
    <p style="font-size: 12px; color: #666; margin-bottom: 20px;">ë”ë¸” í´ë¦­ ì‹œ ì•„ì´í…œì´ ì‚­ì œë©ë‹ˆë‹¤.</p>

    <div class="shop-container">
        <div class="tabs">
            <div class="tab active" onclick="switchTab('furniture')">ê°€êµ¬</div>
            <div class="tab" onclick="switchTab('character')">ìºë¦­í„°</div>
            <div class="tab" onclick="switchTab('wallpaper')">ë²½ì§€</div>
        </div>
        
        <div id="list-furniture" class="item-list">
            <img src="https://cdn-icons-png.flaticon.com/512/963/963864.png" class="shop-item" onclick="addItem('pc', this.src)">
            <img src="https://cdn-icons-png.flaticon.com/512/2311/2311453.png" class="shop-item" onclick="addItem('table', this.src)">
            <img src="https://cdn-icons-png.flaticon.com/512/3016/3016832.png" class="shop-item" onclick="addItem('sofa', this.src)">
            <img src="https://cdn-icons-png.flaticon.com/512/2311/2311440.png" class="shop-item" onclick="addItem('bed', this.src)">
            <img src="https://cdn-icons-png.flaticon.com/512/3534/3534064.png" class="shop-item" onclick="addItem('plant', this.src)">
        </div>

        <div id="list-character" class="item-list" style="display:none;">
            <img src="https://cdn-icons-png.flaticon.com/512/1674/1674291.png" class="shop-item" onclick="addItem('hero1', this.src)">
            <img src="https://cdn-icons-png.flaticon.com/512/1674/1674292.png" class="shop-item" onclick="addItem('hero2', this.src)">
            <img src="https://cdn-icons-png.flaticon.com/512/1674/1674294.png" class="shop-item" onclick="addItem('hero3', this.src)">
        </div>

        <div id="list-wallpaper" class="item-list" style="display:none;">
            <div class="shop-item" style="background:#2a2a2a" onclick="changeWall('#2a2a2a')"></div>
            <div class="shop-item" style="background:#3a4a5a" onclick="changeWall('#3a4a5a')"></div>
            <div class="shop-item" style="background:#5a3a3a" onclick="changeWall('#5a3a3a')"></div>
            <div class="shop-item" style="background:#3a5a4a" onclick="changeWall('#3a5a4a')"></div>
        </div>
    </div>

    <div class="room-viewport">
        <div class="iso-base">
            <div id="floor"></div>
            <div class="wall wall-left" id="wall-l"></div>
            <div class="wall wall-right" id="wall-r"></div>
            <div id="items-container" style="position: absolute; top:0; left:0; width:100%; height:100%; transform-style: preserve-3d;"></div>
        </div>
    </div>

    <div class="controls">
        <button class="btn-save" onclick="saveRoom()">ë°°ì¹˜ ì €ì¥í•˜ê¸°</button>
        <button style="background:#333; color:white" onclick="location.reload()">ì´ˆê¸°í™”</button>
    </div>

    <script>
        let placedItems = [];
        const container = document.getElementById('items-container');
        const SNAP_SIZE = 40; // ê·¸ë¦¬ë“œ ìŠ¤ëƒ… ë‹¨ìœ„

        // íƒ­ ì „í™˜
        function switchTab(type) {
            document.querySelectorAll('.item-list').forEach(l => l.style.display = 'none');
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById('list-' + type).style.display = 'flex';
            event.target.classList.add('active');
        }

        // ë²½ì§€ ë³€ê²½
        function changeWall(color) {
            document.getElementById('wall-l').style.backgroundColor = color;
            document.getElementById('wall-r').style.backgroundColor = color;
            localStorage.setItem('ow_wall_color', color);
        }

        // ì•„ì´í…œ ì¶”ê°€
        function addItem(type, src) {
            const id = 'item_' + Date.now();
            const itemObj = { id, src, x: 0, y: 0 };
            placedItems.push(itemObj);
            renderItem(itemObj);
        }

        function renderItem(obj) {
            // ì•„ì´ì†Œë©”íŠ¸ë¦­ ë°°ì¹˜ë¥¼ ìœ„í•´ divì™€ imgë¥¼ ë¶„ë¦¬ (Z-index ë° ì—­íšŒì „ ë•Œë¬¸)
            const wrapper = document.createElement('div');
            wrapper.className = 'placed-item';
            wrapper.id = obj.id;
            wrapper.style.transform = `translate3d(${obj.x}px, ${obj.y}px, 0) rotateZ(-45deg) rotateX(-60deg)`;
            wrapper.style.transformStyle = 'preserve-3d';
            
            const img = document.createElement('img');
            img.src = obj.src;
            img.style.width = '100%';
            img.style.pointerEvents = 'none';
            img.style.transform = 'translateY(-50%)'; // ë°”ë‹¥ì— ë¶™ì–´ ë³´ì´ê²Œ ì¡°ì •

            wrapper.appendChild(img);
            wrapper.onmousedown = (e) => startDrag(e, obj, wrapper);
            wrapper.ondblclick = () => { placedItems = placedItems.filter(i => i.id !== obj.id); wrapper.remove(); };

            container.appendChild(wrapper);
        }

        function startDrag(e, data, el) {
            e.preventDefault();
            el.classList.add('dragging');

            const startX = e.clientX;
            const startY = e.clientY;
            const initX = data.x;
            const initY = data.y;

            function onMove(me) {
                // ë§ˆìš°ìŠ¤ ì´ë™ ê±°ë¦¬ë¥¼ ì•„ì´ì†Œë©”íŠ¸ë¦­ ì¢Œí‘œê³„ë¡œ ë³€í™˜ (ê°„ëµí™”)
                let dx = (me.clientX - startX);
                let dy = (me.clientY - startY);

                // ì•„ì´ì†Œë©”íŠ¸ë¦­ ì´ë™ ë³´ì • (íšŒì „ ê°ë„ì— ë”°ë¥¸ ê°€ì¤‘ì¹˜)
                let moveX = initX + (dx + dy) * 0.8;
                let moveY = initY + (dy - dx) * 0.8;

                // ğŸ“Œ ê·¸ë¦¬ë“œ ìŠ¤ëƒ… ë¡œì§
                data.x = Math.round(moveX / SNAP_SIZE) * SNAP_SIZE;
                data.y = Math.round(moveY / SNAP_SIZE) * SNAP_SIZE;

                // ë²”ìœ„ ì œí•œ (ë°”ë‹¥ ì•ˆìª½)
                data.x = Math.max(0, Math.min(data.x, 360));
                data.y = Math.max(0, Math.min(data.y, 360));

                el.style.transform = `translate3d(${data.x}px, ${data.y}px, 0) rotateZ(-45deg) rotateX(-60deg)`;
                el.style.zIndex = Math.floor(data.x + data.y); // ê¹Šì´ê°(Z-index) ìë™ ì¡°ì ˆ
            }

            function onUp() {
                el.classList.remove('dragging');
                document.removeEventListener('mousemove', onMove);
                document.removeEventListener('mouseup', onUp);
            }

            document.addEventListener('mousemove', onMove);
            document.addEventListener('mouseup', onUp);
        }

        function saveRoom() {
            localStorage.setItem('ow_room_data', JSON.stringify(placedItems));
            alert("ë°© ë°°ì¹˜ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
        }

        window.onload = () => {
            const saved = localStorage.getItem('ow_room_data');
            const savedColor = localStorage.getItem('ow_wall_color');
            if(savedColor) changeWall(savedColor);
            if(saved) {
                placedItems = JSON.parse(saved);
                placedItems.forEach(renderItem);
            }
        };
    </script>
</body>
</html>
