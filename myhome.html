<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Quarter View Home</title>
<style>
body {
  margin:0;
  display:flex;
  background:#1a1a1a;
  color:white;
  font-family:monospace;
}
#ui {
  width:140px;
  background:#111;
  padding:8px;
}
button {
  width:100%;
  margin-bottom:6px;
}
canvas {
  flex:1;
  background:#222;
  image-rendering:pixelated;
  touch-action:none;
}
</style>
</head>
<body>

<div id="ui">
  <b>Î∞∞Ïπò</b>
  <button onclick="select('chair')">ÏùòÏûê</button>
  <button onclick="select('table')">ÌÖåÏù¥Î∏î</button>
  <button onclick="select('character')">Ï∫êÎ¶≠ÌÑ∞</button>
  <hr>
  <button onclick="select(null)">ÏÑ†ÌÉù Ìï¥Ï†ú</button>
</div>

<canvas id="c"></canvas>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth - 140;
canvas.height = window.innerHeight;

const TILE_W = 64;
const TILE_H = 32;
const WALL_H = 64;
const MAP = 6;

const OFFSET_Y = 60;

const color = {
  floor:"#555",
  wall:"#777",
  chair:"#c96",
  table:"#9c6",
  character:"#6cf"
};

let selected = null;
let dragging = null;
const objects = [];

function iso(x,y){
  return {
    x:(x-y)*TILE_W/2 + canvas.width/2,
    y:(x+y)*TILE_H/2 + OFFSET_Y
  };
}

function drawFloor(){
  for(let y=0;y<MAP;y++){
    for(let x=0;x<MAP;x++){
      const p=iso(x,y);
      ctx.fillStyle=color.floor;
      ctx.beginPath();
      ctx.moveTo(p.x, p.y);
      ctx.lineTo(p.x+TILE_W/2, p.y+TILE_H/2);
      ctx.lineTo(p.x, p.y+TILE_H);
      ctx.lineTo(p.x-TILE_W/2, p.y+TILE_H/2);
      ctx.closePath();
      ctx.fill();
    }
  }
}

// üî• ÏßÑÏßú Î≤Ω
function drawWalls(){
  // Îí§Ï™Ω Î≤Ω
  for(let x=0;x<MAP;x++){
    const p=iso(x,0);
    ctx.fillStyle=color.wall;
    ctx.fillRect(
      p.x-TILE_W/2,
      p.y-WALL_H,
      TILE_W,
      WALL_H
    );
  }

  // ÏôºÏ™Ω Î≤Ω
  for(let y=0;y<MAP;y++){
    const p=iso(0,y);
    ctx.fillStyle="#666";
    ctx.beginPath();
    ctx.moveTo(p.x-TILE_W/2, p.y);
    ctx.lineTo(p.x-TILE_W/2, p.y-WALL_H);
    ctx.lineTo(p.x, p.y-WALL_H+TILE_H/2);
    ctx.lineTo(p.x, p.y+TILE_H/2);
    ctx.closePath();
    ctx.fill();
  }
}

function drawObjects(){
  objects
    .sort((a,b)=>a.y-b.y)
    .forEach(o=>{
      const p=iso(o.x,o.y);
      ctx.fillStyle=color[o.type];
      ctx.fillRect(p.x-10, p.y+8, 20, 24);
    });
}

function render(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawWalls();
  drawFloor();
  drawObjects();
}

render();

function select(t){ selected=t; }

function screenToGrid(mx,my){
  const dx = mx - canvas.width/2;
  const dy = my - OFFSET_Y;
  return {
    x:Math.floor(dy/TILE_H + dx/TILE_W),
    y:Math.floor(dy/TILE_H - dx/TILE_W)
  };
}

canvas.addEventListener("pointerdown",e=>{
  const r=canvas.getBoundingClientRect();
  const mx=e.clientX-r.left;
  const my=e.clientY-r.top;

  for(let o of objects){
    const p=iso(o.x,o.y);
    if(mx>p.x-12 && mx<p.x+12 && my>p.y && my<p.y+30){
      dragging=o; return;
    }
  }

  if(selected){
    const g=screenToGrid(mx,my);
    if(g.x>=0&&g.y>=0&&g.x<MAP&&g.y<MAP){
      objects.push({x:g.x,y:g.y,type:selected});
      render();
    }
  }
});

canvas.addEventListener("pointermove",e=>{
  if(!dragging)return;
  const r=canvas.getBoundingClientRect();
  const g=screenToGrid(
    e.clientX-r.left,
    e.clientY-r.top
  );
  dragging.x=Math.max(0,Math.min(MAP-1,g.x));
  dragging.y=Math.max(0,Math.min(MAP-1,g.y));
  render();
});

canvas.addEventListener("pointerup",()=>dragging=null);
</script>

</body>
</html>
