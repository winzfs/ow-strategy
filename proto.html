<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Overwatch Hub Professional</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700;900&family=Orbitron:wght@900&display=swap" rel="stylesheet">

    <script src="config.js"></script>

    <style>
        :root { --ow-orange: #ff9c00; --ow-dark: #0b0c10; }
        body { font-family: 'Noto Sans KR', sans-serif; background: var(--ow-dark); color: white; margin: 0; overflow: hidden; }
        
        /* [ê°œì„ ] ì‚¬ì´ë“œë°” ë””ìì¸ */
        .sidebar { width: 280px; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); background: #14161c; border-right: 1px solid rgba(255,255,255,0.05); height: 100vh; position: fixed; z-index: 100; }
        .sidebar.collapsed { width: 88px; }
        .main-content { margin-left: 280px; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); height: 100vh; overflow-y: auto; background: #0f1014; }
        .main-content.expanded { margin-left: 88px; }

        /* [ìˆ˜ì •] ì‚¬ì´ë“œë°” í•˜ì´ë¼ì´íŠ¸ - ì•„ì´ì½˜ì„ ê°€ë¦¬ì§€ ì•ŠëŠ” Pill ë””ìì¸ */
        .nav-item { 
            position: relative;
            display: flex; align-items: center; gap: 1.2rem; 
            padding: 0.8rem 1.2rem; margin: 0.4rem 0.8rem;
            border-radius: 0.75rem; font-weight: 700; transition: 0.3s; 
            color: #9ca3af; white-space: nowrap;
        }
        .nav-item i { min-width: 24px; text-align: center; z-index: 2; }
        .nav-item span { z-index: 2; }
        .nav-item:hover { color: white; background: rgba(255,255,255,0.05); }
        
        /* í™œì„±í™” ìƒíƒœ í•˜ì´ë¼ì´íŠ¸ ìˆ˜ì • */
        .nav-item.active { color: var(--ow-orange); background: rgba(255, 156, 0, 0.1); }
        .nav-item.active::before {
            content: ''; position: absolute; left: 0; top: 20%; height: 60%; width: 4px;
            background: var(--ow-orange); border-radius: 0 4px 4px 0;
        }

        .collapsed .hidden-text { opacity: 0; pointer-events: none; width: 0; display: none; }
        
        /* ì„¹ì…˜ ì• ë‹ˆë©”ì´ì…˜ */
        .view-section { display: none; animation: fadeIn 0.4s ease-out; }
        .view-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* ê¸€ë˜ìŠ¤ëª¨í”¼ì¦˜ */
        .glass { background: rgba(255, 255, 255, 0.02); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.05); border-radius: 16px; transition: 0.3s; }
        .glass:hover { border-color: var(--ow-orange); background: rgba(255, 255, 255, 0.04); }
        
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--ow-orange); }
    </style>
</head>
<body>

    <aside id="sidebar" class="sidebar flex flex-col py-6">
        <div class="flex items-center gap-4 mb-12 px-6 cursor-pointer" onclick="UI.toggleSidebar()">
            <div class="min-w-[40px] h-10 bg-[#ff9c00] rounded-xl flex items-center justify-center shadow-lg shadow-orange-500/30">
                <i class="fa-solid fa-bolt text-black text-xl"></i>
            </div>
            <h1 class="hidden-text font-black tracking-tighter text-2xl font-ow">OW HUB</h1>
        </div>

        <nav class="flex-1">
            <button onclick="Router.go('matching')" class="nav-item active w-full" title="íŒŒí‹° ë§¤ì¹­">
                <i class="fa-solid fa-users-viewfinder text-xl"></i>
                <span class="hidden-text">íŒŒí‹° ë§¤ì¹­</span>
            </button>
            <button onclick="Router.go('community')" class="nav-item w-full" title="ì»¤ë®¤ë‹ˆí‹°">
                <i class="fa-solid fa-comments text-xl"></i>
                <span class="hidden-text">ì»¤ë®¤ë‹ˆí‹°</span>
            </button>
            <button onclick="UI.toggleNoti()" class="nav-item w-full" title="ì•Œë¦¼">
                <i class="fa-solid fa-bell text-xl"></i>
                <span class="hidden-text">ì•Œë¦¼í•¨</span>
            </button>
        </nav>

        <div class="px-4 mt-auto">
            <div class="glass p-3 flex items-center gap-3">
                <div class="min-w-[40px] h-10 rounded-full bg-gradient-to-tr from-orange-500 to-yellow-500 flex items-center justify-center font-black text-black">A</div>
                <div class="hidden-text overflow-hidden">
                    <p class="text-xs font-bold truncate">Admin User</p>
                    <p class="text-[10px] text-gray-500">jazzhjm@gmail.com</p>
                </div>
            </div>
        </div>
    </aside>

    <main id="main-content" class="main-content">
        <header class="sticky top-0 z-40 bg-[#0f1014]/90 backdrop-blur-md border-b border-white/5 px-10 py-5 flex justify-between items-center">
            <div class="relative w-1/2 max-w-md">
                <i class="fa-solid fa-magnifying-glass absolute left-4 top-1/2 -translate-y-1/2 text-gray-500"></i>
                <input type="text" id="search-input" oninput="App.search(this.value)" placeholder="ì›í•˜ëŠ” ìš”ì›ì´ë‚˜ ê¸€ì„ ê²€ìƒ‰í•˜ì„¸ìš”..." class="w-full bg-white/5 border border-white/10 rounded-full py-2.5 pl-12 pr-6 outline-none focus:border-[#ff9c00] transition">
            </div>
            <div class="flex items-center gap-6">
                <div id="live-user-count" class="text-[11px] font-bold text-blue-400 bg-blue-400/10 px-4 py-1.5 rounded-full border border-blue-400/20 uppercase tracking-widest">
                    ì—°ê²° ì¤‘...
                </div>
                <button onclick="UI.openModal()" class="bg-[#ff9c00] text-black font-black px-6 py-2.5 rounded-full hover:scale-105 active:scale-95 transition flex items-center gap-2">
                    <i class="fa-solid fa-plus"></i> <span>ì‘ì„±í•˜ê¸°</span>
                </button>
            </div>
        </header>

        <section id="view-matching" class="view-section active p-10">
            <div class="flex justify-between items-end mb-10">
                <div>
                    <h2 class="text-4xl font-black italic mb-2 uppercase tracking-tighter">SQUAD FINDER</h2>
                    <p id="live-party-count" class="text-gray-500 text-xs font-bold tracking-widest uppercase">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                </div>
                <div class="flex bg-white/5 p-1 rounded-xl border border-white/10" id="filter-btns">
                    <button onclick="App.filter('all')" class="px-6 py-2 rounded-lg text-xs font-black bg-[#ff9c00] text-black shadow-lg">ì „ì²´</button>
                    <button onclick="App.filter('íƒ±ì»¤')" class="px-6 py-2 rounded-lg text-xs font-black text-gray-400 hover:text-white transition">íƒ±ì»¤</button>
                    <button onclick="App.filter('ë”œëŸ¬')" class="px-6 py-2 rounded-lg text-xs font-black text-gray-400 hover:text-white transition">ë”œëŸ¬</button>
                    <button onclick="App.filter('ì§€ì›')" class="px-6 py-2 rounded-lg text-xs font-black text-gray-400 hover:text-white transition">ì§€ì›</button>
                </div>
            </div>
            <div id="matching-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
        </section>

        <section id="view-community" class="view-section p-10">
            <h2 class="text-4xl font-black italic mb-10 uppercase tracking-tighter">COMMUNITY</h2>
            <div id="community-list" class="space-y-4 max-w-5xl"></div>
        </section>
    </main>

    <div id="modal-write" class="fixed inset-0 z-[200] hidden flex items-center justify-center p-6 bg-black/90 backdrop-blur-md">
        <div class="glass w-full max-w-xl p-8 bg-[#16171d] border-white/10">
            <div class="flex justify-between items-center mb-10">
                <div class="flex gap-6">
                    <button id="tab-p" onclick="UI.switchModalTab('p')" class="text-xl font-black border-b-2 border-[#ff9c00] text-[#ff9c00] pb-1">íŒŒí‹° ë§¤ì¹­</button>
                    <button id="tab-c" onclick="UI.switchModalTab('c')" class="text-xl font-black text-gray-500 pb-1">ì»¤ë®¤ë‹ˆí‹°</button>
                </div>
                <button onclick="UI.closeModal()" class="text-gray-400 hover:text-white"><i class="fa-solid fa-xmark text-2xl"></i></button>
            </div>
            
            <form id="write-form" class="space-y-5">
                <input type="hidden" id="form-type" value="p">
                <div id="p-fields" class="grid grid-cols-2 gap-4">
                    <select id="f-role" class="bg-white/5 border border-white/10 rounded-xl p-4 outline-none focus:border-[#ff9c00] text-sm">
                        <option value="íƒ±ì»¤">ğŸ›¡ï¸ í¬ì§€ì…˜: íƒ±ì»¤</option><option value="ë”œëŸ¬">âš”ï¸ í¬ì§€ì…˜: ë”œëŸ¬</option><option value="ì§€ì›">ğŸ’‰ í¬ì§€ì…˜: ì§€ì›</option>
                    </select>
                    <select id="f-tier" class="bg-white/5 border border-white/10 rounded-xl p-4 outline-none focus:border-[#ff9c00] text-sm">
                        <option>ë¸Œë¡ ì¦ˆ</option><option>ì‹¤ë²„</option><option>ê³¨ë“œ</option><option>í”Œë˜í‹°ë„˜</option><option>ë‹¤ì´ì•„ëª¬ë“œ</option><option>ë§ˆìŠ¤í„°</option><option>ê·¸ëœë“œë§ˆìŠ¤í„°</option>
                    </select>
                </div>
                <input type="text" id="f-tag" placeholder="ë°°í‹€íƒœê·¸(Name#1234) ë˜ëŠ” ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" class="w-full bg-white/5 border border-white/10 rounded-xl p-4 outline-none focus:border-[#ff9c00]">
                <textarea id="f-content" rows="6" placeholder="ë‚´ìš©ì„ ìƒì„¸íˆ ì…ë ¥í•´ ì£¼ì„¸ìš”..." class="w-full bg-white/5 border border-white/10 rounded-xl p-4 outline-none focus:border-[#ff9c00]"></textarea>
                <button type="submit" class="w-full bg-[#ff9c00] text-black font-black py-4 rounded-xl shadow-lg hover:shadow-orange-500/20 transition duration-300">ì‘ì„± ë° ê²Œì‹œ</button>
            </form>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <script>
        // [Engineer] config.jsì—ì„œ ì„¤ì • ë¡œë“œ ë° ì´ˆê¸°í™”
        if (typeof firebaseConfig === 'undefined') {
            alert('config.js íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ê±°ë‚˜ ì„¤ì •ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
        }

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // [Programmer] í•µì‹¬ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œì§
        const App = {
            posts: [],
            community: [],
            currentView: 'matching',
            filterRole: 'all',
            searchKey: '',

            init() {
                this.listenData();
                this.setupForm();
                this.trackPresence();
            },

            listenData() {
                // íŒŒí‹° ë§¤ì¹­ ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ
                db.collection("posts").orderBy("timestamp", "desc").onSnapshot(snap => {
                    this.posts = snap.docs.map(doc => ({id: doc.id, ...doc.data()}));
                    this.renderMatching();
                });
                // ì»¤ë®¤ë‹ˆí‹° ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ
                db.collection("community").orderBy("timestamp", "desc").onSnapshot(snap => {
                    this.community = snap.docs.map(doc => ({id: doc.id, ...doc.data()}));
                    if(this.currentView === 'community') this.renderCommunity();
                });
            },

            setupForm() {
                document.getElementById('write-form').onsubmit = async (e) => {
                    e.preventDefault();
                    const type = document.getElementById('form-type').value;
                    const data = {
                        tag: document.getElementById('f-tag').value,
                        content: document.getElementById('f-content').value,
                        timestamp: firebase.firestore.FieldValue.serverTimestamp()
                    };

                    try {
                        if(type === 'p') {
                            await db.collection("posts").add({
                                ...data,
                                role: document.getElementById('f-role').value,
                                tier: document.getElementById('f-tier').value,
                                manner: 5.0
                            });
                        } else {
                            await db.collection("community").add(data);
                        }
                        UI.closeModal();
                        e.target.reset();
                    } catch (err) {
                        console.error("ì €ì¥ ì‹¤íŒ¨:", err);
                        alert("ì‘ì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                    }
                };
            },

            filter(role) {
                this.filterRole = role;
                this.renderMatching();
                UI.updateFilterUI(role);
            },

            search(val) {
                this.searchKey = val.toLowerCase();
                this.currentView === 'matching' ? this.renderMatching() : this.renderCommunity();
            },

            renderMatching() {
                const grid = document.getElementById('matching-grid');
                let list = this.posts.filter(p => this.filterRole === 'all' || p.role === this.filterRole);
                if(this.searchKey) list = list.filter(p => p.tag.toLowerCase().includes(this.searchKey) || p.content.toLowerCase().includes(this.searchKey));
                
                grid.innerHTML = list.map(p => `
                    <div class="glass p-8 group relative overflow-hidden">
                        <div class="flex justify-between items-start mb-6">
                            <span class="text-[11px] font-black text-[#ff9c00] border-b-2 border-[#ff9c00] pb-0.5 uppercase tracking-widest">${p.role}</span>
                            <div class="px-3 py-1 bg-black/40 border border-white/10 rounded-md text-[10px] font-bold text-gray-400 italic">${p.tier}</div>
                        </div>
                        <h4 class="text-2xl font-black mb-1 group-hover:text-[#ff9c00] transition">${p.tag}</h4>
                        <div class="flex items-center gap-1 text-[10px] text-yellow-500 mb-6">
                            <i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i>
                            <span class="ml-2 text-gray-500">Manner 5.0</span>
                        </div>
                        <p class="text-sm text-gray-400 line-clamp-2 h-10 mb-8 leading-relaxed">${p.content || 'ì „íˆ¬ ì¤€ë¹„ ì™„ë£Œ!'}</p>
                        <button class="w-full py-4 bg-white/5 rounded-xl text-xs font-black hover:bg-[#ff9c00] hover:text-black transition duration-300">ì‹ ì²­í•˜ê¸°</button>
                    </div>
                `).join('');
                document.getElementById('live-party-count').innerText = `ëª¨ì§‘ ì¤‘ì¸ íŒŒí‹°: ${list.length}`;
            },

            renderCommunity() {
                const listEl = document.getElementById('community-list');
                let list = this.community;
                if(this.searchKey) list = list.filter(c => c.tag.toLowerCase().includes(this.searchKey) || c.content.toLowerCase().includes(this.searchKey));

                listEl.innerHTML = list.map(c => `
                    <div class="glass p-6 hover:border-[#ff9c00] transition-all cursor-pointer flex justify-between items-center group">
                        <div class="flex-1 pr-6">
                            <div class="flex items-center gap-3 mb-2">
                                <span class="text-[10px] bg-[#ff9c00]/10 text-[#ff9c00] font-black px-2 py-0.5 rounded uppercase">Post</span>
                                <h3 class="text-lg font-black group-hover:text-[#ff9c00] transition">${c.tag}</h3>
                            </div>
                            <p class="text-sm text-gray-500 line-clamp-1">${c.content}</p>
                        </div>
                        <div class="text-right">
                            <p class="text-[10px] font-bold text-gray-600 mb-1">JUST NOW</p>
                            <i class="fa-solid fa-chevron-right text-gray-700 group-hover:text-[#ff9c00]"></i>
                        </div>
                    </div>
                `).join('');
            },

            trackPresence() {
                // ê¸°ì¡´ index (22).htmlì˜ ì ‘ì†ì ì¹´ìš´íŒ… ë¡œì§
                const el = document.getElementById('live-user-count');
                const update = () => el.innerText = `${Math.floor(Math.random() * 15) + 38}ëª… ì ‘ì† ì¤‘`;
                update(); setInterval(update, 10000);
            }
        };

        // [Designer] ì¸í„°í˜ì´ìŠ¤ í•¸ë“¤ëŸ¬
        const UI = {
            toggleSidebar() {
                document.getElementById('sidebar').classList.toggle('collapsed');
                document.getElementById('main-content').classList.toggle('expanded');
            },
            openModal() { document.getElementById('modal-write').classList.remove('hidden'); },
            closeModal() { document.getElementById('modal-write').classList.add('hidden'); },
            switchModalTab(type) {
                document.getElementById('form-type').value = type;
                document.getElementById('p-fields').style.display = type === 'p' ? 'grid' : 'none';
                document.getElementById('tab-p').className = type === 'p' ? "text-xl font-black border-b-2 border-[#ff9c00] text-[#ff9c00] pb-1" : "text-xl font-black text-gray-500 pb-1";
                document.getElementById('tab-c').className = type === 'c' ? "text-xl font-black border-b-2 border-[#ff9c00] text-[#ff9c00] pb-1" : "text-xl font-black text-gray-500 pb-1";
            },
            updateFilterUI(role) {
                document.querySelectorAll('#filter-btns button').forEach(b => {
                    b.classList = "px-6 py-2 rounded-lg text-xs font-black text-gray-400 hover:text-white transition";
                    if(b.innerText.includes(role) || (role==='all' && b.innerText==='ì „ì²´')) {
                        b.classList = "px-6 py-2 rounded-lg text-xs font-black bg-[#ff9c00] text-black shadow-lg shadow-orange-500/30";
                    }
                });
            }
        };

        const Router = {
            go(view) {
                App.currentView = view;
                document.querySelectorAll('.view-section').forEach(s => s.classList.remove('active'));
                document.getElementById(`view-${view}`).classList.add('active');
                
                document.querySelectorAll('.nav-item').forEach(n => {
                    n.classList.remove('active');
                    if(n.title.includes(view === 'matching' ? 'íŒŒí‹°' : 'ì»¤ë®¤ë‹ˆí‹°')) n.classList.add('active');
                });
                
                view === 'community' ? App.renderCommunity() : App.renderMatching();
            }
        };

        App.init();
    </script>
</body>
</html>
