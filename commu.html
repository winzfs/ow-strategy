<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜¤ë²„ì›Œì¹˜ í—ˆë¸Œ ì»¤ë®¤ë‹ˆí‹° - ììœ ê²Œì‹œíŒ & íŒŒí‹°ëª¨ì§‘ í›„ê¸°</title>
    <meta name="description" content="ì˜¤ë²„ì›Œì¹˜ ìœ ì €ë“¤ê³¼ ì†Œí†µí•˜ëŠ” ììœ  ê²Œì‹œíŒì…ë‹ˆë‹¤. íŒŒí‹° í›„ê¸°, íŒ ê³µìœ , ì§ˆë¬¸ ë‹µë³€ ë“± ë‹¤ì–‘í•œ ì´ì•¼ê¸°ë¥¼ ë‚˜ëˆ„ì–´ë³´ì„¸ìš”.">
    <meta name="keywords" content="ì˜¤ë²„ì›Œì¹˜ ì»¤ë®¤ë‹ˆí‹°, ì˜¤ë²„ì›Œì¹˜ ê²Œì‹œíŒ, ì˜¤ë²„ì›Œì¹˜ ììœ ê²Œì‹œíŒ, ì˜¤ë²„ì›Œì¹˜ íŒ, owhub ì»¤ë®¤ë‹ˆí‹°">
    <link rel="canonical" href="https://owhub.vercel.app/commu.html">

    <meta property="og:title" content="Overwatch Hub - ì»¤ë®¤ë‹ˆí‹°">
    <meta property="og:description" content="ì˜¤ë²„ì›Œì¹˜ ìš”ì›ë“¤ì˜ ì‹¤ì‹œê°„ ì†Œí†µ ê³µê°„!">
    <meta property="og:url" content="https://owhub.vercel.app/commu.html">
    <style>
        :root { --accent: #ff9c00; --bg-dark: #111; }
        body { background: var(--bg-dark); color: white; font-family: 'Pretendard', sans-serif; margin: 0; padding-bottom: 50px; overflow-x: hidden; }
        
        /* ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ */
        nav { background: #000; padding: 12px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #333; position: sticky; top: 0; z-index: 100; }
        .nav-left { display: flex; gap: 20px; align-items: center; }
        .nav-tabs { display: flex; gap: 20px; align-items: center; }
        .nav-tabs a, .nav-tabs div { cursor: pointer; font-weight: 600; font-size: 14px; text-decoration: none; }
        
        .container { max-width: 800px; margin: 30px auto; padding: 0 15px; }
        .box { background: #1a1a1a; padding: 20px; border-radius: 12px; border: 1px solid #333; margin-bottom: 15px; position: relative; }
        
        /* ë²„íŠ¼ ë° ì…ë ¥ì°½ */
        .btn-main { background: var(--accent); color: black; border: none; padding: 12px; border-radius: 8px; font-weight: 700; cursor: pointer; width: 100%; margin-top: 10px; transition: 0.2s; }
        .btn-main:hover { opacity: 0.9; }
        .btn-sub { background: #333; color: white; border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; font-size: 12px; }
        input, textarea { background: #252525; border: 1px solid #333; color: white; padding: 10px; border-radius: 8px; width: 100%; box-sizing: border-box; margin-bottom: 8px; font-family: inherit; }
        
        .post-info { font-size: 12px; color: #888; margin-bottom: 10px; display: flex; justify-content: space-between; }
        .author-name { color: var(--accent); font-weight: bold; }
        
        /* ì™¼ìª½ ì‚¬ì´ë“œë°” ìŠ¤íƒ€ì¼ */
        #sidebar { position: fixed; left: -300px; top: 0; width: 280px; height: 100%; background: #1a1a1a; z-index: 1000; transition: 0.3s; box-shadow: 5px 0 15px rgba(0,0,0,0.5); padding: 20px; box-sizing: border-box; }
        #sidebar-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 999; }
        
        /* ë°˜ì‘í˜• */
        @media (max-width: 600px) {
            .container { margin-top: 15px; }
            #sidebar { width: 250px; }
        }
    </style>
</head>
<body>

<nav>
    <div class="nav-left">
        <button onclick="toggleSidebar()" style="background:none; border:none; color:white; font-size:22px; cursor:pointer; padding:0; margin-right:5px;">â˜°</button>
        <div class="nav-tabs">
            <a href="index.html" style="color:#888;">íŒŒí‹°ì°¾ê¸°</a>
            <div style="color:var(--accent); border-bottom: 2px solid var(--accent); padding-bottom: 2px;">ì»¤ë®¤ë‹ˆí‹°</div>
        </div>
    </div>
    <div id="auth-ui"></div>
</nav>

<div id="sidebar">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:30px;">
        <h3 style="margin:0; color:var(--accent); letter-spacing: 1px;">MY PAGE</h3>
        <button onclick="toggleSidebar()" style="background:none; border:none; color:#888; font-size:24px; cursor:pointer;">&times;</button>
    </div>
    <div id="my-info" style="margin-bottom:30px; border-bottom:1px solid #333; padding-bottom:20px;">
        <p style="font-size:12px; color:#666; margin:0;">ì ‘ì† ì¤‘ì¸ ìš”ì›</p>
        <h2 id="my-btag-display" style="margin:8px 0; font-size:18px; color:var(--accent);">-</h2>
        <div id="sidebar-logout-container"></div>
    </div>
    <h4 style="font-size:14px; color:#888; margin-bottom:15px; display: flex; align-items: center; gap: 5px;">ğŸ“ ë‚´ê°€ ì“´ ê²Œì‹œê¸€</h4>
    <div id="my-posts-list" style="overflow-y:auto; max-height:calc(100% - 250px);">
        <p style="font-size: 12px; color:#444; text-align: center; margin-top: 20px;">ê¸€ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
    </div>
</div>
<div id="sidebar-overlay" onclick="toggleSidebar()"></div>

<div class="container">
    <div class="box">
        <h4 style="margin:0 0 10px 0; color:var(--accent); font-size: 16px;">ğŸ’¬ ììœ ê²Œì‹œíŒ</h4>
        <input type="text" id="comm-title" placeholder="ì œëª©">
        <textarea id="comm-content" placeholder="ì˜¤ë²„ì›Œì¹˜ì— ëŒ€í•œ ì´ì•¼ê¸°ë¥¼ ììœ ë¡­ê²Œ ë‚˜ëˆ„ì–´ë³´ì„¸ìš”! (ë¹„ì†ì–´ ì‚¬ìš© ì‹œ ì œì¬ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤)" rows="4"></textarea>
        <button class="btn-main" id="btn-comm-post">ê¸€ ë“±ë¡í•˜ê¸°</button>
    </div>
    <div id="comm-list"></div>
</div>

<section class="container" style="margin-top: 50px;">
    <details style="background: #1a1a1a; border-radius: 12px; border: 1px solid #333; overflow: hidden; transition: 0.3s;">
        <summary style="padding: 18px; color: var(--accent); font-size: 14px; font-weight: bold; cursor: pointer; list-style: none; display: flex; justify-content: space-between; align-items: center; background: #222;">
            <span>ğŸ’¡ ì»¤ë®¤ë‹ˆí‹° ê°€ì´ë“œë¼ì¸</span>
            <span style="font-size: 12px; color: #666;">í¼ì³ë³´ê¸° â–¼</span>
        </summary>
        <div style="padding: 20px; background: #151515; font-size: 13px; color: #888; line-height: 1.7;">
            <strong>â€¢ í´ë¦° ì»¤ë®¤ë‹ˆí‹°:</strong> ìš•ì„¤, ë¹„ë°©, ì •ì¹˜ì  ë°œì–¸ ë“±ì€ ì‚¬ì „ ê²½ê³  ì—†ì´ ì‚­ì œë©ë‹ˆë‹¤.<br>
            <strong>â€¢ ì¶”ì²œ ì‹œìŠ¤í…œ:</strong> ìœ ìµí•œ ê¸€ì—ëŠ” 'ì¶”ì²œ'ì„ ëˆŒëŸ¬ ê²©ë ¤í•´ì£¼ì„¸ìš”. ë³¸ì¸ ê¸€ì€ ì¶”ì²œì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.<br>
            <strong>â€¢ ë¬¸ì˜/ì‹ ê³ :</strong> ì„œë¹„ìŠ¤ ì´ìš© ì¤‘ ë¶ˆí¸í•¨ì€ <strong>jazzhjm@gmail.com</strong>ìœ¼ë¡œ ì œë³´í•´ì£¼ì„¸ìš”.
        </div>
    </details>
</section>

<footer style="text-align: center; padding: 50px 20px; color: #444; font-size: 12px; border-top: 1px solid #222; margin-top: 40px;">
    <div style="margin-bottom: 20px; display: flex; justify-content: center; gap: 20px;">
        <a href="index.html" style="color: #666; text-decoration: none;">íŒŒí‹°ì°¾ê¸°</a>
        <a href="commu.html" style="color: var(--accent); text-decoration: none; font-weight: bold;">ì»¤ë®¤ë‹ˆí‹°</a>
        <a href="terms.html" style="color: #666; text-decoration: none;">ì´ìš©ì•½ê´€</a>
        <a href="privacy.html" style="color: #666; text-decoration: none;">ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨</a>
    </div>
    <p>Â© 2026 Overwatch Hub (OWHUB). All rights reserved.</p>
</footer>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, doc, getDoc, getDocs, deleteDoc, updateDoc, arrayUnion, arrayRemove, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    const firebaseConfig = { 
        apiKey: "AIzaSyA96CFg3o1TpD5lu-0rYMlIp16Ev8URDuw", 
        authDomain: "ow-party-97936.firebaseapp.com", 
        projectId: "ow-party-97936", 
        storageBucket: "ow-party-97936.firebasestorage.app", 
        messagingSenderId: "15782204013", 
        appId: "1:15782204013:web:5c74ef2e603c311fc82564" 
    };
    
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    const ADMIN_EMAILS = ["jazzhjm@gmail.com", "jazzhjm@gmaol.com"];
    let myBtag = "ìµëª…";
    let unsubscribePosts = null;

    const timeSince = (date) => {
        const seconds = Math.floor((Date.now() - date) / 1000);
        if (seconds < 60) return "ë°©ê¸ˆ ì „";
        if (seconds < 3600) return Math.floor(seconds/60) + "ë¶„ ì „";
        if (seconds < 86400) return Math.floor(seconds/3600) + "ì‹œê°„ ì „";
        return Math.floor(seconds/86400) + "ì¼ ì „";
    };

    onAuthStateChanged(auth, async (user) => {
        const authUI = document.getElementById('auth-ui');
        const sidebarLogout = document.getElementById('sidebar-logout-container');
        
        if (user) {
            const userSnap = await getDoc(doc(db, "users", user.uid));
            myBtag = userSnap.exists() ? userSnap.data().btag : "ìµëª… ìš”ì›";
            document.getElementById('my-btag-display').innerText = myBtag;
            
            authUI.innerHTML = `<button id="btn-logout" class="btn-sub">ë¡œê·¸ì•„ì›ƒ</button>`;
            sidebarLogout.innerHTML = `<button class="btn-sub" style="width:100%; margin-top:15px; background: #444;" onclick="auth.signOut().then(()=>location.reload())">ë¡œê·¸ì•„ì›ƒ</button>`;
            
            document.getElementById('btn-logout').onclick = () => signOut(auth).then(() => location.reload());
        } else {
            myBtag = "ìµëª…";
            authUI.innerHTML = `<button onclick="location.href='index.html'" class="btn-sub">ë¡œê·¸ì¸</button>`;
            sidebarLogout.innerHTML = `<button class="btn-main" onclick="location.href='index.html'" style="padding:8px; font-size:12px;">ë¡œê·¸ì¸í•˜ê³  ì‹œì‘í•˜ê¸°</button>`;
        }
        startListing();
    });

    function startListing() {
        if (unsubscribePosts) unsubscribePosts();
        const q = query(collection(db, "community"), orderBy("createdAt", "desc"));
        unsubscribePosts = onSnapshot(q, (snap) => {
            const list = document.getElementById('comm-list');
            const user = auth.currentUser;
            const isAdmin = user && ADMIN_EMAILS.includes(user.email);

            list.innerHTML = snap.docs.map(docSnap => {
                const d = docSnap.data();
                const id = docSnap.id;
                const likes = d.likes || [];
                const hasLiked = user && likes.includes(user.uid);
                const isMine = user && user.uid === d.uid;

                return `
                    <div class="box" id="post-${id}">
                        <div class="post-info">
                            <span><span class="author-name">${d.author || 'ìµëª…'}</span> â€¢ ${timeSince(d.createdAt)}</span>
                            ${(isMine || isAdmin) ? `<button onclick="window.delCommPost('${id}')" style="background:none; border:none; color:#ff3c3c; cursor:pointer; font-size:11px;">ì‚­ì œ</button>` : ''}
                        </div>
                        <h4 style="margin:5px 0 12px 0; line-height:1.4;">${d.title}</h4>
                        <p style="font-size:14px; color:#ccc; line-height:1.6; white-space:pre-wrap; margin-bottom:15px;">${d.content}</p>
                        
                        <div style="display:flex; gap:18px; border-top:1px solid #222; padding-top:15px; margin-top:10px;">
                            <span onclick="window.toggleLike('${id}', '${d.uid}')" style="cursor:pointer; font-size:13px; display:flex; align-items:center; gap:5px; color:${hasLiked ? 'var(--accent)' : '#666'}">
                                ${hasLiked ? 'ğŸ§¡' : 'ğŸ¤'} ì¶”ì²œ ${likes.length}
                            </span>
                            <span onclick="window.toggleComments('${id}')" style="cursor:pointer; font-size:13px; display:flex; align-items:center; gap:5px; color:#666;">
                                ğŸ’¬ ëŒ“ê¸€ ${d.commentCount || 0}
                            </span>
                        </div>
                        
                        <div id="comment-section-${id}" style="display:none; margin-top:15px; background:#111; padding:12px; border-radius:10px; border: 1px solid #222;">
                            <div id="comment-list-${id}" style="font-size:13px; margin-bottom:12px; max-height:200px; overflow-y:auto;"></div>
                            <div style="display:flex; gap:8px;">
                                <input type="text" id="cmt-input-${id}" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..." style="margin:0; font-size:12px; height:35px;">
                                <button onclick="window.addComment('${id}')" class="btn-main" style="width:65px; margin:0; height:35px; padding:0; font-size:12px;">ë“±ë¡</button>
                            </div>
                        </div>
                    </div>`;
            }).join('');
        });
    }

    // --- ì£¼ìš” ê¸°ëŠ¥ í•¨ìˆ˜ ---
    window.toggleSidebar = () => {
        const sb = document.getElementById('sidebar');
        const ov = document.getElementById('sidebar-overlay');
        const isOpen = sb.style.left === '0px';
        sb.style.left = isOpen ? '-300px' : '0px';
        ov.style.display = isOpen ? 'none' : 'block';
        if(!isOpen) loadMyPosts();
    };

    async function loadMyPosts() {
        const user = auth.currentUser;
        const listContainer = document.getElementById('my-posts-list');
        if (!user) {
            listContainer.innerHTML = `<p style="font-size:12px; color:#444; text-align:center; margin-top:20px;">ë¡œê·¸ì¸ í›„ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>`;
            return;
        }
        
        const q = query(collection(db, "community"), where("uid", "==", user.uid), orderBy("createdAt", "desc"));
        const snap = await getDocs(q);
        
        if(snap.empty) {
            listContainer.innerHTML = `<p style="font-size:12px; color:#444; text-align:center; margin-top:20px;">ì‘ì„±í•œ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>`;
            return;
        }

        listContainer.innerHTML = snap.docs.map(docSnap => {
            const d = docSnap.data();
            return `
                <div style="background:#222; padding:12px; border-radius:8px; margin-bottom:10px; font-size:12px; cursor:pointer; border:1px solid #333;" onclick="location.href='#post-${docSnap.id}'; toggleSidebar();">
                    <div style="font-weight:600; color:#eee; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; margin-bottom:5px;">${d.title}</div>
                    <div style="color:#555; display:flex; gap:10px;">
                        <span>ğŸ§¡ ${d.likes?.length || 0}</span>
                        <span>ğŸ’¬ ${d.commentCount || 0}</span>
                        <span style="margin-left:auto;">${timeSince(d.createdAt)}</span>
                    </div>
                </div>`;
        }).join('');
    }

    window.toggleLike = async (postId, authorUid) => {
        const user = auth.currentUser;
        if (!user) return alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
        if (user.uid === authorUid) return alert("ë³¸ì¸ì˜ ê¸€ì€ ì¶”ì²œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        
        const postRef = doc(db, "community", postId);
        const postSnap = await getDoc(postRef);
        const likes = postSnap.data().likes || [];
        
        await updateDoc(postRef, { 
            likes: likes.includes(user.uid) ? arrayRemove(user.uid) : arrayUnion(user.uid) 
        });
    };

    window.toggleComments = (postId) => {
        const section = document.getElementById(`comment-section-${postId}`);
        if (section.style.display === 'none') {
            section.style.display = 'block';
            const q = query(collection(db, "comments"), where("postId", "==", postId), orderBy("createdAt", "asc"));
            onSnapshot(q, (snap) => {
                const cmtList = document.getElementById(`comment-list-${postId}`);
                if(snap.empty) {
                    cmtList.innerHTML = `<p style="color:#444; font-size:11px; text-align:center;">ì²« ëŒ“ê¸€ì„ ë‚¨ê²¨ë³´ì„¸ìš”!</p>`;
                } else {
                    cmtList.innerHTML = snap.docs.map(doc => {
                        const c = doc.data();
                        return `<div style="margin-bottom:10px; border-bottom:1px solid #1a1a1a; padding-bottom:8px;">
                            <div style="display:flex; justify-content:space-between; margin-bottom:3px;">
                                <b style="color:var(--accent); font-size:11px;">${c.author}</b>
                                <span style="color:#444; font-size:10px;">${timeSince(c.createdAt)}</span>
                            </div>
                            <div style="color:#bbb; font-size:12px;">${c.content}</div>
                        </div>`;
                    }).join('');
                }
            });
        } else { section.style.display = 'none'; }
    };

    window.addComment = async (postId) => {
        const user = auth.currentUser;
        const input = document.getElementById(`cmt-input-${postId}`);
        const content = input.value.trim();
        if (!user) return alert("ë¡œê·¸ì¸ í›„ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.");
        if (!content) return;

        try {
            await addDoc(collection(db, "comments"), { 
                postId, uid: user.uid, author: myBtag.split('#')[0], content, createdAt: Date.now() 
            });
            const postRef = doc(db, "community", postId);
            const postSnap = await getDoc(postRef);
            await updateDoc(postRef, { commentCount: (postSnap.data().commentCount || 0) + 1 });
            input.value = "";
        } catch(e) { alert("ëŒ“ê¸€ ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."); }
    };

    document.getElementById('btn-comm-post').onclick = async () => {
        const user = auth.currentUser;
        if (!user) return alert("ë¡œê·¸ì¸ í›„ ê¸€ì„ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
        
        const title = document.getElementById('comm-title').value.trim();
        const content = document.getElementById('comm-content').value.trim();
        
        if(!title || !content) return alert("ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.");

        try {
            await addDoc(collection(db, "community"), { 
                uid: user.uid, author: myBtag.split('#')[0], title, content, 
                createdAt: Date.now(), likes: [], commentCount: 0 
            });
            document.getElementById('comm-title').value = "";
            document.getElementById('comm-content').value = "";
            alert("ê²Œì‹œê¸€ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
        } catch (e) { alert("ë“±ë¡ ì‹¤íŒ¨: ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤."); }
    };

    window.delCommPost = async (id) => { 
        if(confirm("ê²Œì‹œê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            try { await deleteDoc(doc(db, "community", id)); } 
            catch(e) { alert("ì‚­ì œ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤."); }
        }
    };
</script>
</body>
</html>
