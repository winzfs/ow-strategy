<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Overwatch Hub - Community</title>
    <style>
        /* (ê¸°ì¡´ style ì½”ë“œë“¤...) */
        :root { --accent: #ff9c00; --bg-dark: #111; }
        body { background: var(--bg-dark); color: white; font-family: 'Pretendard', sans-serif; margin: 0; }
        nav { background: #000; padding: 12px 20px; display: flex; justify-content: space-between; border-bottom: 1px solid #333; }
        .nav-tabs { display: flex; gap: 20px; }
        .container { max-width: 800px; margin: 30px auto; padding: 0 15px; }
        .box { background: #1a1a1a; padding: 20px; border-radius: 12px; border: 1px solid #333; margin-bottom: 15px; }
        .btn-main { background: var(--accent); color: black; border: none; padding: 12px; border-radius: 8px; font-weight: 700; cursor: pointer; width: 100%; }
        input, textarea { background: #252525; border: 1px solid #333; color: white; padding: 10px; border-radius: 8px; width: 100%; box-sizing: border-box; margin-bottom: 8px; }
    </style>
</head>
<body>

<nav>
    <div class="nav-tabs">
        <a href="party.html" style="text-decoration:none; color:#888; font-weight:600; font-size:14px;">íŒŒí‹°ì°¾ê¸°</a>
        <div style="color:var(--accent); border-bottom: 2px solid var(--accent);">ì»¤ë®¤ë‹ˆí‹°</div>
    </div>
</nav>

<div class="container">
    <div class="box">
        <h4 style="margin:0; color:var(--accent);">ğŸ’¬ ììœ ê²Œì‹œíŒ</h4>
        <input type="text" id="comm-title" placeholder="ì œëª©">
        <textarea id="comm-content" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" rows="4"></textarea>
        <button class="btn-main" id="btn-comm-post">ê¸€ ë“±ë¡</button>
    </div>
    <div id="comm-list"></div>
</div>

<script type="module">
    // Firebase ì„¤ì •ì€ index.htmlê³¼ ë™ì¼í•˜ê²Œ ë³µì‚¬í•´ì„œ ë„£ìœ¼ì„¸ìš”
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    const firebaseConfig = { 
    apiKey: "AIzaSyA96CFg3o1TpD5lu-0rYMlIp16Ev8URDuw", 
    authDomain: "ow-party-97936.firebaseapp.com", 
    projectId: "ow-party-97936", 
    storageBucket: "ow-party-97936.firebasestorage.app", 
    messagingSenderId: "15782204013", 
    appId: "1:15782204013:web:5c74ef2e603c311fc82564" 
};
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    let currentUser = null;

    onAuthStateChanged(auth, (user) => {
        currentUser = user;
        if(!user) {
            alert("ê²Œì‹œíŒì€ ë¡œê·¸ì¸ í›„ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤. ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.");
            location.href = "index.html";
        }
    });

    // ê¸€ì“°ê¸° ë¡œì§
    // ê¸€ì“°ê¸° ë¡œì§ ìˆ˜ì •
document.getElementById('btn-comm-post').onclick = async () => {
    if (!auth.currentUser) return alert("ë¡œê·¸ì¸ ì„¸ì…˜ì„ í™•ì¸ ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ê±°ë‚˜ ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.");
    
    const title = document.getElementById('comm-title').value;
    const content = document.getElementById('comm-content').value;
    
    if(!title.trim() || !content.trim()) return alert("ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.");

    try {
        await addDoc(collection(db, "community"), {
            uid: auth.currentUser.uid,
            title: title,
            content: content,
            createdAt: Date.now()
        });
        alert("ê¸€ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!");
        document.getElementById('comm-title').value = "";
        document.getElementById('comm-content').value = "";
    } catch (e) {
        console.error("ë“±ë¡ ì—ëŸ¬:", e);
        alert("ê¸€ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. (ê¶Œí•œ ì˜¤ë¥˜ ê°€ëŠ¥ì„±)");
    }
};


    // ì‹¤ì‹œê°„ ëª©ë¡ ë Œë”ë§
    onSnapshot(query(collection(db, "community"), orderBy("createdAt", "desc")), (snap) => {
        const list = document.getElementById('comm-list');
        list.innerHTML = snap.docs.map(docSnap => {
            const d = docSnap.data();
            return `
                <div class="box">
                    <h4>${d.title}</h4>
                    <p style="font-size:14px; color:#ccc;">${d.content}</p>
                </div>`;
        }).join('');
    });
</script>
</body>
</html>
