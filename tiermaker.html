<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OW2 Tier Maker Final</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        :root {
            --ow-orange: #f99e1a;
            --bg-dark: #121418;
            --panel: #1e232d;
            --tier-s: #ff7f7f; --tier-a: #ffbf7f; --tier-b: #ffff7f; --tier-c: #7fff7f; --tier-d: #7fbfff;
        }

        body {
            background: var(--bg-dark); color: white; font-family: sans-serif;
            margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center;
            overflow-x: hidden; touch-action: pan-y; /* ìŠ¤í¬ë¡¤ì€ í—ˆìš©í•˜ë˜ ê°€ë¡œ ì œìŠ¤ì²˜ ë°©ì§€ */
        }

        /* íƒ­ ë²„íŠ¼ */
        .tab-menu { display: flex; width: 100%; max-width: 800px; gap: 5px; margin-bottom: 5px; }
        .tab-btn {
            flex: 1; padding: 12px; border: none; background: #252a34; color: #888;
            font-weight: bold; cursor: pointer; border-radius: 5px 5px 0 0;
            transition: 0.2s;
        }
        .tab-btn.active { background: var(--ow-orange); color: black; }

        /* í‹°ì–´í‘œ ì˜ì—­ (ìº¡ì²˜ ëŒ€ìƒ) */
        .capture-wrap { width: 100%; max-width: 800px; background: var(--bg-dark); padding: 10px; box-sizing: border-box; }
        .tier-board-container { display: none; } /* ê¸°ë³¸ ìˆ¨ê¹€ */
        .tier-board-container.active { display: block; } /* í™œì„±í™”ëœ íƒ­ë§Œ í‘œì‹œ */

        .tier-header { text-align: center; color: var(--ow-orange); margin-bottom: 10px; font-weight: bold; font-size: 1.2rem; }
        
        .tier-row { 
            display: flex; background: var(--panel); min-height: 75px; 
            margin-bottom: 5px; border-radius: 4px; border: 1px solid #333; position: relative; 
        }
        
        .tier-label {
            width: 60px; min-width: 60px; display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem; font-weight: 900; color: #000; border-radius: 4px 0 0 4px;
        }

        .dropzone { 
            flex-grow: 1; display: flex; flex-wrap: wrap; padding: 5px; gap: 5px; 
            align-content: flex-start; min-height: 60px; 
        }

        /* ì˜ì›… ì•„ì´ì½˜ ìŠ¤íƒ€ì¼ */
        .hero {
            width: 50px; height: 60px; background-color: #333; 
            border: 2px solid #555; border-radius: 4px;
            background-size: cover; background-position: center;
            position: relative; 
            touch-action: none; /* ì¤‘ìš”: ë“œë˜ê·¸ ì‹œ ë¸Œë¼ìš°ì € ê¸°ë³¸ ë™ì‘ ë°©ì§€ */
            user-select: none;
            z-index: 10;
        }
        .hero span { 
            position: absolute; bottom: 0; left: 0; width: 100%; 
            font-size: 9px; background: rgba(0,0,0,0.8); text-align: center; padding: 2px 0; 
            pointer-events: none; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        
        /* ë“œë˜ê·¸ ì¤‘ì¸ ìƒíƒœ */
        .hero.dragging { 
            position: fixed; pointer-events: none; z-index: 9999; 
            transform: scale(1.1); box-shadow: 0 0 10px rgba(0,0,0,0.5); opacity: 0.8;
        }
        /* ë“œë˜ê·¸ê°€ ì‹œì‘ëœ ì›ë³¸ ìë¦¬ (íë¦¿í•˜ê²Œ) */
        .hero.placeholder { opacity: 0.3; }

        /* ì‚­ì œ ë²„íŠ¼ (í‹°ì–´í‘œ ìœ„ì— ìˆì„ ë•Œë§Œ í´ë¦­ ê°€ëŠ¥) */
        .del-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 0, 0, 0.7); display: none;
            align-items: center; justify-content: center;
            font-weight: bold; font-size: 20px; color: white; cursor: pointer;
            z-index: 20;
        }
        /* selected í´ë˜ìŠ¤ê°€ ë¶™ìœ¼ë©´ ì‚­ì œ ì˜¤ë²„ë ˆì´ í‘œì‹œ */
        .tier-row .hero.selected .del-overlay { display: flex; }

        /* ë¡œìŠ¤í„° ì˜ì—­ (ì „ì²´ í‘œì‹œ) */
        .roster-container { width: 100%; max-width: 800px; margin-top: 20px; background: #0f1115; padding: 10px; border-radius: 8px; }
        .roster-section { margin-bottom: 20px; }
        .roster-head { 
            color: #ccc; font-size: 0.9rem; margin-bottom: 8px; border-bottom: 1px solid #333; 
            padding-bottom: 5px; display: flex; align-items: center; gap: 5px;
        }
        .icon-role { width: 20px; height: 20px; background: #333; border-radius: 50%; display: inline-block; text-align: center; line-height: 20px; font-size: 12px; }
        
        /* ì»¨íŠ¸ë¡¤ íŒ¨ë„ */
        .controls { width: 100%; max-width: 800px; display: flex; gap: 5px; margin: 10px 0; flex-wrap: wrap; }
        .btn { padding: 10px; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; color: white; background: #333; }
        .btn-save { background: var(--ow-orange); color: black; flex-grow: 1; }
        
        .row-del { position: absolute; left: -25px; top: 50%; transform: translateY(-50%); color: #666; font-size: 20px; padding: 10px; cursor: pointer; border: none; background: none; }
    </style>
</head>
<body>

    <div class="tab-menu">
        <button class="tab-btn active" onclick="showBoard('tank')">ğŸ›¡ï¸ TANK</button>
        <button class="tab-btn" onclick="showBoard('damage')">âš”ï¸ DPS</button>
        <button class="tab-btn" onclick="showBoard('support')">ğŸ’‰ SUP</button>
    </div>

    <div class="capture-wrap" id="capture-area">
        
        <div id="board-tank" class="tier-board-container active">
            <div class="tier-header">ëŒê²© ì˜ì›… í‹°ì–´ë¦¬ìŠ¤íŠ¸</div>
            <div class="tier-box">
                </div>
        </div>

        <div id="board-damage" class="tier-board-container">
            <div class="tier-header">ê³µê²© ì˜ì›… í‹°ì–´ë¦¬ìŠ¤íŠ¸</div>
            <div class="tier-box"></div>
        </div>

        <div id="board-support" class="tier-board-container">
            <div class="tier-header">ì§€ì› ì˜ì›… í‹°ì–´ë¦¬ìŠ¤íŠ¸</div>
            <div class="tier-box"></div>
        </div>

    </div>

    <div class="controls">
        <button class="btn" onclick="addTierRow()">+ í‹°ì–´ ì¶”ê°€</button>
        <button class="btn btn-save" onclick="saveImage()">ì´ë¯¸ì§€ ì €ì¥</button>
    </div>

    <div class="roster-container">
        <div class="roster-section">
            <div class="roster-head"><span class="icon-role">ğŸ›¡ï¸</span> ëŒê²© (Tank)</div>
            <div id="roster-tank" class="dropzone" style="background: rgba(255,255,255,0.02);"></div>
        </div>
        <div class="roster-section">
            <div class="roster-head"><span class="icon-role">âš”ï¸</span> ê³µê²© (Damage)</div>
            <div id="roster-damage" class="dropzone" style="background: rgba(255,255,255,0.02);"></div>
        </div>
        <div class="roster-section">
            <div class="roster-head"><span class="icon-role">ğŸ’‰</span> ì§€ì› (Support)</div>
            <div id="roster-support" class="dropzone" style="background: rgba(255,255,255,0.02);"></div>
        </div>
    </div>

<script>
    const IMG_PATH = "img/heroes/"; // ì´ë¯¸ì§€ ê²½ë¡œ
    
    // ë°ì´í„°
    const heroes = {
        tank: ['dva','doomfist','junkerqueen','orisa','ramattra','reinhardt','roadhog','sigma','winston','wreckingball','zarya','mauga','hazard'],
        damage: ['ashe','bastion','cassidy','echo','genji','hanzo','junkrat','mei','pharah','reaper','sojourn','soldier76','sombra','symmetra','torbjorn','tracer','widowmaker','venture','freja','vendetta'],
        support: ['ana','baptiste','brigitte','illari','kiriko','lifeweaver','lucio','mercy','moira','zenyatta','juno','wuyang']
    };
    
    // í‹°ì–´ ì´ˆê¸°ê°’
    const defaultTiers = [
        {name:'S', color:'#ff7f7f'}, {name:'A', color:'#ffbf7f'}, {name:'B', color:'#ffff7f'},
        {name:'C', color:'#7fff7f'}, {name:'D', color:'#7fbfff'}
    ];

    let currentDrag = null; // í˜„ì¬ ë“œë˜ê·¸ ì¤‘ì¸ ìš”ì†Œ
    let touchOffset = {x:0, y:0};
    let activeTab = 'tank';

    // 1. ì´ˆê¸°í™”
    function init() {
        // í‹°ì–´í‘œ 3ê°œ ìƒì„±
        ['tank', 'damage', 'support'].forEach(role => {
            const container = document.querySelector(`#board-${role} .tier-box`);
            defaultTiers.forEach(t => addRowToContainer(container, t.name, t.color));
        });

        // ë¡œìŠ¤í„° ìƒì„±
        Object.keys(heroes).forEach(role => {
            const roster = document.getElementById(`roster-${role}`);
            heroes[role].forEach(id => {
                const el = createHeroElement(id, role);
                roster.appendChild(el);
            });
        });
    }

    // 2. ì˜ì›… ìš”ì†Œ ìƒì„± (ì´ë²¤íŠ¸ ë°”ì¸ë”© í¬í•¨)
    function createHeroElement(id, role) {
        const div = document.createElement('div');
        div.className = 'hero';
        div.style.backgroundImage = `url('${IMG_PATH}${id}.png')`;
        div.dataset.role = role; // ì›ë˜ ì—­í•  ì €ì¥
        div.dataset.id = id;
        
        // ì´ë¦„í‘œ
        div.innerHTML = `<span>${id}</span><div class="del-overlay">Ã—</div>`;

        // í„°ì¹˜ ì´ë²¤íŠ¸ (ëª¨ë°”ì¼ ë“œë˜ê·¸ í•µì‹¬)
        div.addEventListener('touchstart', handleTouchStart, {passive: false});
        div.addEventListener('touchmove', handleTouchMove, {passive: false});
        div.addEventListener('touchend', handleTouchEnd);
        
        // í´ë¦­ ì´ë²¤íŠ¸ (ì‚­ì œ ë²„íŠ¼ í† ê¸€)
        div.addEventListener('click', (e) => {
            e.stopPropagation(); // ë²„ë¸”ë§ ë°©ì§€
            
            // ë§Œì•½ í‹°ì–´í‘œ ì•ˆì— ìˆë‹¤ë©´ ì„ íƒ ìƒíƒœ í† ê¸€
            if (div.closest('.tier-row')) {
                const isSelected = div.classList.contains('selected');
                document.querySelectorAll('.hero').forEach(h => h.classList.remove('selected'));
                if (!isSelected) div.classList.add('selected');
            }
        });

        // ì‚­ì œ ë²„íŠ¼ í´ë¦­ (ì˜¤ë²„ë ˆì´)
        div.querySelector('.del-overlay').addEventListener('click', (e) => {
            e.stopPropagation();
            returnToRoster(div);
        });

        return div;
    }

    // 3. ë¡œìŠ¤í„°ë¡œ ë³µê·€ í•¨ìˆ˜
    function returnToRoster(heroEl) {
        const role = heroEl.dataset.role;
        const roster = document.getElementById(`roster-${role}`);
        heroEl.classList.remove('selected', 'dragging', 'placeholder');
        heroEl.style.position = ''; 
        heroEl.style.left = ''; 
        heroEl.style.top = '';
        heroEl.style.width = ''; 
        heroEl.style.height = '';
        roster.appendChild(heroEl);
    }

    // 4. ëª¨ë°”ì¼ í„°ì¹˜ í•¸ë“¤ëŸ¬ (í™”ë©´ ê¹¨ì§ ë°©ì§€ ë¡œì§)
    function handleTouchStart(e) {
        const touch = e.touches[0];
        const target = e.currentTarget;

        // ì„ íƒ í•´ì œ
        document.querySelectorAll('.hero').forEach(h => h.classList.remove('selected'));

        currentDrag = target;
        
        // ìœ„ì¹˜ ê³„ì‚°
        const rect = target.getBoundingClientRect();
        touchOffset.x = touch.clientX - rect.left;
        touchOffset.y = touch.clientY - rect.top;

        // ë“œë˜ê·¸ ì‹œì‘ ì‹œê°ì  íš¨ê³¼
        target.classList.add('dragging');
        
        // ì›ë³¸ ìë¦¬ì— ê³µê°„ ìœ ì§€ë¥¼ ìœ„í•´ ë³µì œë³¸ì´ ì•„ë‹ˆë¼, 
        // position:fixedë¡œ ë„ìš°ê³  DOM ì´ë™ì€ touchendì—ì„œ ì²˜ë¦¬.
        // ì—¬ê¸°ì„œëŠ” ìŠ¤íƒ€ì¼ë§Œ fixedë¡œ ë°”ê¾¸ê³  ì¢Œí‘œë¥¼ í„°ì¹˜ ìœ„ì¹˜ë¡œ ê°±ì‹ 
        target.style.left = (touch.clientX - touchOffset.x) + 'px';
        target.style.top = (touch.clientY - touchOffset.y) + 'px';
    }

    function handleTouchMove(e) {
        if (!currentDrag) return;
        e.preventDefault(); // ìŠ¤í¬ë¡¤ ë°©ì§€ (í™”ë©´ ê¹¨ì§ ë°©ì§€ í•µì‹¬)
        
        const touch = e.touches[0];
        currentDrag.style.left = (touch.clientX - touchOffset.x) + 'px';
        currentDrag.style.top = (touch.clientY - touchOffset.y) + 'px';
    }

    function handleTouchEnd(e) {
        if (!currentDrag) return;
        
        // ë“œë˜ê·¸ ìŠ¤íƒ€ì¼ ì œê±°
        currentDrag.classList.remove('dragging');
        currentDrag.style.position = '';
        currentDrag.style.left = '';
        currentDrag.style.top = '';

        // ì†ê°€ë½ ë—€ ìœ„ì¹˜ ê°ì§€
        const touch = e.changedTouches[0];
        // ë“œë˜ê·¸ ì¤‘ì¸ ìš”ì†ŒëŠ” pointer-events: none ìƒíƒœì—¬ì•¼ ì•„ë˜ ìš”ì†Œë¥¼ ê°ì§€í•¨ (CSS ì²˜ë¦¬ë¨)
        const elementBelow = document.elementFromPoint(touch.clientX, touch.clientY);
        const dropzone = elementBelow ? elementBelow.closest('.dropzone') : null;

        if (dropzone) {
            dropzone.appendChild(currentDrag);
        } else {
            // ë“œë¡­ì¡´ì´ ì•„ë‹ˆë©´ ì›ë˜ ë¡œìŠ¤í„°ë¡œ (ë˜ëŠ” ì œìë¦¬ ìœ ì§€í•˜ë ¤ë©´ ì´ ë¶€ë¶„ ìˆ˜ì •)
            // ì—¬ê¸°ì„œëŠ” ì‹¤ìˆ˜ë¡œ ë°–ìœ¼ë¡œ ëºì„ ë•Œ ë¡œìŠ¤í„°ë¡œ ë³µê·€ì‹œí‚´
             returnToRoster(currentDrag);
        }

        currentDrag = null;
    }

    // 5. ìœ í‹¸ë¦¬í‹°: íƒ­ ì „í™˜
    function showBoard(role) {
        activeTab = role;
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        event.currentTarget.classList.add('active');
        
        document.querySelectorAll('.tier-board-container').forEach(b => b.classList.remove('active'));
        document.getElementById(`board-${role}`).classList.add('active');
    }

    // 6. ìœ í‹¸ë¦¬í‹°: í‹°ì–´ ì¤„ ì¶”ê°€
    function addTierRow() {
        const container = document.querySelector(`#board-${activeTab} .tier-box`);
        addRowToContainer(container, "N", "#888888");
    }

    function addRowToContainer(container, name, color) {
        const row = document.createElement('div');
        row.className = 'tier-row';
        row.innerHTML = `
            <button class="row-del" onclick="removeRow(this)">Ã—</button>
            <div class="tier-label" style="background:${color}" contenteditable="true">${name}</div>
            <div class="dropzone"></div>
        `;
        container.appendChild(row);
    }

    function removeRow(btn) {
        const row = btn.parentElement;
        // ì•ˆì— ìˆëŠ” ì˜ì›…ë“¤ êµ¬ì¶œ
        row.querySelectorAll('.hero').forEach(hero => returnToRoster(hero));
        row.remove();
    }

    // 7. ì´ë¯¸ì§€ ì €ì¥
    function saveImage() {
        document.querySelectorAll('.hero').forEach(h => h.classList.remove('selected'));
        const target = document.querySelector('.capture-wrap'); // ì „ì²´ ìº¡ì²˜ ì˜ì—­
        
        html2canvas(target, {
            backgroundColor: '#121418',
            scale: 2 // ê³ í•´ìƒë„
        }).then(canvas => {
            const link = document.createElement('a');
            link.download = `ow2-${activeTab}-tierlist.png`;
            link.href = canvas.toDataURL();
            link.click();
        });
    }

    // ë°”íƒ• í´ë¦­ ì‹œ ì„ íƒ í•´ì œ
    document.addEventListener('click', () => {
        document.querySelectorAll('.hero').forEach(h => h.classList.remove('selected'));
    });

    init();
</script>
</body>
</html>
