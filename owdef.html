<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ìš´ë¹¨ì›¹ì¡´ë§ê²œ: ëª¨ë°”ì¼ ì—ë””ì…˜</title>
    <style>
        body { margin: 0; background: #000; color: #fff; font-family: 'Arial', sans-serif; overflow: hidden; touch-action: none; display: flex; justify-content: center; align-items: center; height: 100vh; }
        #game-container { position: relative; width: 100vw; height: 100vh; max-width: 500px; max-height: 850px; }
        canvas { background: #111; display: block; width: 100%; height: 100%; }
        .screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 20; }
        h1 { color: #f1c40f; text-shadow: 0 0 10px gold; font-size: 32px; }
        .btn { padding: 15px 40px; background: #e74c3c; border: none; color: white; border-radius: 50px; font-size: 18px; cursor: pointer; margin-top: 20px; }
        #ui-layer { position: absolute; top: 20px; left: 20px; pointer-events: none; z-index: 10; font-weight: bold; font-size: 18px; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="game-container">
        <div id="ui-layer" class="hidden">
            <div style="color:#f1c40f">ğŸ’° <span id="gold-val">100</span></div>
            <div style="color:#3498db">ğŸŒŠ WAVE <span id="wave-val">1</span></div>
            <div style="color:#ff4d4d">ğŸ‘¾ MOBS <span id="mob-val">0</span>/50</div>
        </div>

        <canvas id="gameCanvas"></canvas>

        <div id="start-screen" class="screen">
            <h1>ìš´ë¹¨ì›¹ì¡´ë§ê²œ Mobile</h1>
            <button class="btn" onclick="startGame()">ê²Œì„ ì‹œì‘</button>
        </div>

        <div id="over-screen" class="screen hidden">
            <h1 style="color:#e74c3c">GAME OVER</h1>
            <button class="btn" onclick="location.reload()">ë‹¤ì‹œ ì‹œì‘</button>
        </div>
    </div>

<script>
/** ğŸ‘¨â€ğŸ’» í”„ë¡œê·¸ë˜ë¨¸ & ì—”ì§€ë‹ˆì–´: ê³ ì„±ëŠ¥ ë Œë”ë§ ë° í„°ì¹˜ ë¡œì§ **/
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const container = document.getElementById('game-container');

// í™”ë©´ í¬ê¸° ëŒ€ì‘
function resize() {
    canvas.width = container.clientWidth;
    canvas.height = container.clientHeight;
}
window.addEventListener('resize', resize);
resize();

let gold = 100;
let wave = 1;
let monsters = [];
let board = Array(16).fill(null);
let gameState = 'START';
let particles = [];
let spawnTimer = 0;
let lastTime = 0;

// ë“œë˜ê·¸ ìƒíƒœ ê´€ë¦¬
let dragTarget = null;
let touchX = 0, touchY = 0;

const UNIT_TYPES = [
    { name: 'ê²€ì‚¬', color: '#ecf0f1', range: 150, speed: 1000 },
    { name: 'ê¶ìˆ˜', color: '#3498db', range: 250, speed: 500 },
    { name: 'ë²•ì‚¬', color: '#9b59b6', range: 200, speed: 1500 },
    { name: 'ë„ì ', color: '#f1c40f', range: 130, speed: 1200 }
];

// ë³´ë“œ ë° ê²½ë¡œ ì„¤ì • (ê¸°íšì ì„¤ê³„)
const BOARD_SIZE = 4;
const TILE_SIZE = 80;
const BOARD_X = (canvas.width - (TILE_SIZE * BOARD_SIZE)) / 2;
const BOARD_Y = 350;

// ëª¬ìŠ¤í„° íšŒì „ ê²½ë¡œ (ë³´ë“œ ì£¼ë³€ì„ ì‚¬ê°í˜•ìœ¼ë¡œ íšŒì „)
const PATH = [
    {x1: 30, y1: 150, x2: 450, y2: 150}, // Top
    {x1: 450, y1: 150, x2: 450, y2: 750}, // Right
    {x1: 450, y1: 750, x2: 30, y2: 750},  // Bottom
    {x1: 30, y1: 750, x2: 30, y2: 150}    // Left
];

function startGame() {
    gameState = 'PLAY';
    document.getElementById('start-screen').classList.add('hidden');
    document.getElementById('ui-layer').classList.remove('hidden');
    lastTime = performance.now();
    requestAnimationFrame(gameLoop);
}

function spawnMonster() {
    monsters.push({
        x: PATH[0].x1, y: PATH[0].y1,
        hp: 10 * wave, maxHp: 10 * wave,
        pathIdx: 0,
        dist: 0,
        speed: 2 + (wave * 0.2)
    });
}

function gameLoop(time) {
    if (gameState !== 'PLAY') return;
    const dt = time - lastTime;
    lastTime = time;

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // 1. ëª¬ìŠ¤í„° ë¡œì§ (íšŒì „ ê²½ë¡œ)
    spawnTimer += dt;
    if (spawnTimer > 1500) { spawnMonster(); spawnTimer = 0; }

    monsters.forEach((m, idx) => {
        let p = PATH[m.pathIdx];
        let dx = p.x2 - p.x1;
        let dy = p.y2 - p.y1;
        let len = Math.sqrt(dx*dx + dy*dy);
        
        m.x += (dx/len) * m.speed;
        m.y += (dy/len) * m.speed;

        if (Math.hypot(m.x - p.x2, m.y - p.y2) < 5) {
            m.pathIdx = (m.pathIdx + 1) % PATH.length;
            m.x = PATH[m.pathIdx].x1;
            m.y = PATH[m.pathIdx].y1;
        }

        // ëª¬ìŠ¤í„° ê·¸ë¦¬ê¸°
        ctx.fillStyle = '#ff4d4d';
        ctx.fillRect(m.x-15, m.y-15, 30, 30);
        ctx.fillStyle = '#0f0';
        ctx.fillRect(m.x-15, m.y-25, (m.hp/m.maxHp)*30, 5);
    });

    // 2. ë³´ë“œíŒ ë° ìœ ë‹› ê·¸ë¦¬ê¸°
    for (let i = 0; i < 16; i++) {
        const x = BOARD_X + (i % 4) * TILE_SIZE;
        const y = BOARD_Y + Math.floor(i / 4) * TILE_SIZE;
        
        ctx.strokeStyle = '#333';
        ctx.strokeRect(x, y, TILE_SIZE, TILE_SIZE);

        if (board[i] && dragTarget !== i) {
            drawUnit(board[i], x + TILE_SIZE/2, y + TILE_SIZE/2);
            updateUnitAttack(board[i], x + TILE_SIZE/2, y + TILE_SIZE/2, dt);
        }
    }

    // 3. ë“œë˜ê·¸ ì¤‘ì¸ ìœ ë‹› ê·¸ë¦¬ê¸°
    if (dragTarget !== null) {
        ctx.globalAlpha = 0.7;
        drawUnit(board[dragTarget], touchX, touchY);
        ctx.globalAlpha = 1.0;
    }

    // 4. ì†Œí™˜ ë²„íŠ¼ (í•˜ë‹¨)
    ctx.fillStyle = '#222';
    ctx.roundRect(50, canvas.height - 100, canvas.width - 100, 60, 30);
    ctx.fill();
    ctx.fillStyle = '#fff';
    ctx.textAlign = 'center';
    ctx.fillText("ìœ ë‹› ì†Œí™˜ (10G)", canvas.width/2, canvas.height - 65);

    // UI ì—…ë°ì´íŠ¸
    document.getElementById('gold-val').innerText = gold;
    document.getElementById('wave-val').innerText = wave;
    document.getElementById('mob-val').innerText = monsters.length;

    if (monsters.length >= 50) {
        gameState = 'OVER';
        document.getElementById('over-screen').classList.remove('hidden');
    } else {
        requestAnimationFrame(gameLoop);
    }
}

function drawUnit(u, x, y) {
    ctx.fillStyle = u.color;
    ctx.beginPath(); ctx.arc(x, y, 30, 0, Math.PI*2); ctx.fill();
    ctx.fillStyle = '#000'; ctx.font = '12px Arial';
    ctx.fillText(u.name, x, y + 5);
}

function updateUnitAttack(u, ux, uy, dt) {
    u.timer = (u.timer || 0) + dt;
    if (u.timer > u.speed && monsters.length > 0) {
        const target = monsters[0];
        if (Math.hypot(target.x - ux, target.y - uy) < u.range) {
            u.timer = 0;
            ctx.strokeStyle = u.color;
            ctx.beginPath(); ctx.moveTo(ux, uy); ctx.lineTo(target.x, target.y); ctx.stroke();
            target.hp -= 2;
            if (target.hp <= 0) { monsters.shift(); gold += 2; }
        }
    }
}

/** ğŸ› ï¸ ì—”ì§€ë‹ˆì–´: í†µí•© ë“œë˜ê·¸ ë¡œì§ (Mouse & Touch) **/
function getPos(e) {
    const rect = canvas.getBoundingClientRect();
    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
    return { x: clientX - rect.left, y: clientY - rect.top };
}

function onStart(e) {
    const pos = getPos(e);
    touchX = pos.x; touchY = pos.y;

    // ì†Œí™˜ ë²„íŠ¼ í´ë¦­
    if (touchY > canvas.height - 120) {
        spawnUnit(); return;
    }

    // ìœ ë‹› ì„ íƒ
    for (let i = 0; i < 16; i++) {
        const x = BOARD_X + (i % 4) * TILE_SIZE;
        const y = BOARD_Y + Math.floor(i / 4) * TILE_SIZE;
        if (touchX > x && touchX < x + TILE_SIZE && touchY > y && touchY < y + TILE_SIZE) {
            if (board[i]) dragTarget = i;
        }
    }
}

function onMove(e) {
    if (dragTarget === null) return;
    const pos = getPos(e);
    touchX = pos.x; touchY = pos.y;
}

function onEnd() {
    if (dragTarget === null) return;
    
    // ë†“ì€ ìœ„ì¹˜ í™•ì¸
    let dropIdx = -1;
    for (let i = 0; i < 16; i++) {
        const x = BOARD_X + (i % 4) * TILE_SIZE;
        const y = BOARD_Y + Math.floor(i / 4) * TILE_SIZE;
        if (touchX > x && touchX < x + TILE_SIZE && touchY > y && touchY < y + TILE_SIZE) {
            dropIdx = i;
        }
    }

    if (dropIdx !== -1 && dropIdx !== dragTarget) {
        // í•©ì„± ë˜ëŠ” ìœ„ì¹˜ êµí™˜ (ê¸°íš: ì—¬ê¸°ì„œëŠ” ê·¸ëƒ¥ ìœ„ì¹˜ ì´ë™)
        let temp = board[dropIdx];
        board[dropIdx] = board[dragTarget];
        board[dragTarget] = temp;
    }
    dragTarget = null;
}

function spawnUnit() {
    const empty = board.map((v, i) => v === null ? i : null).filter(v => v !== null);
    if (empty.length > 0 && gold >= 10) {
        gold -= 10;
        const idx = empty[Math.floor(Math.random() * empty.length)];
        board[idx] = { ...UNIT_TYPES[Math.floor(Math.random() * UNIT_TYPES.length)] };
    }
}

// ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
canvas.addEventListener('mousedown', onStart);
window.addEventListener('mousemove', onMove);
window.addEventListener('mouseup', onEnd);
canvas.addEventListener('touchstart', onStart);
window.addEventListener('touchmove', onMove);
window.addEventListener('touchend', onEnd);

</script>
</body>
</html>
