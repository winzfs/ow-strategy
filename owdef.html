<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ìš´ë¹¨ì›¹ì¡´ë§ê²œ: ì •ì‹ í”„ë¡œí† íƒ€ì…</title>
    <style>
        body { margin: 0; background: #111; color: #fff; font-family: 'Arial', sans-serif; overflow: hidden; display: flex; justify-content: center; align-items: center; height: 100vh; }
        #game-wrapper { position: relative; width: 500px; height: 750px; border: 4px solid #333; }
        canvas { background: #1a1a1a; display: block; }
        .ui-screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 10; }
        .hidden { display: none !important; }
        h1 { color: #f1c40f; font-size: 40px; margin-bottom: 30px; text-shadow: 0 0 10px gold; }
        .btn { padding: 15px 40px; font-size: 20px; background: #e74c3c; border: none; color: white; border-radius: 10px; cursor: pointer; margin: 10px; }
        .btn:hover { background: #ff5e4d; }
        #stats { position: absolute; top: 10px; left: 10px; pointer-events: none; z-index: 5; font-weight: bold; }
    </style>
</head>
<body>

    <div id="game-wrapper">
        <div id="stats" class="hidden">
            <div style="color:#f1c40f">ğŸ’° GOLD: <span id="gold-val">100</span></div>
            <div style="color:#3498db">ğŸŒŠ WAVE: <span id="wave-val">1</span></div>
            <div style="color:#ff4d4d">ğŸ‘¾ MOBS: <span id="mob-val">0</span> / 50</div>
        </div>

        <canvas id="gameCanvas" width="500" height="750"></canvas>

        <div id="start-screen" class="ui-screen">
            <h1>ìš´ë¹¨ì›¹ì¡´ë§ê²œ</h1>
            <button class="btn" onclick="initGame()">ê²Œì„ ì‹œì‘</button>
        </div>

        <div id="over-screen" class="ui-screen hidden">
            <h1 style="color:#e74c3c">GAME OVER</h1>
            <p id="final-score" style="font-size:20px"></p>
            <button class="btn" onclick="location.reload()">ë‹¤ì‹œ ë„ì „</button>
        </div>
    </div>

<script>
/** ì „ë¬¸ê°€ íŒ€ì˜ í”„ë¡œê·¸ë˜ë° ì„¹ì…˜ **/
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const goldText = document.getElementById('gold-val');
const waveText = document.getElementById('wave-val');
const mobText = document.getElementById('mob-val');

let gameState = 'START';
let gold = 100;
let wave = 1;
let monsters = [];
let board = Array(16).fill(null); // 4x4 ë³´ë“œ
let particles = [];
let lastTime = 0;
let spawnTimer = 0;
let waveTimer = 0;

// ìœ ë‹› ë“±ê¸‰ ë° ëŠ¥ë ¥ ì„¤ì •
const UNIT_TYPES = [
    { name: 'ê²€ì‚¬', color: '#ecf0f1', speed: 800, range: 150, ability: 'ìŠ¤í„´' },
    { name: 'ê¶ìˆ˜', color: '#3498db', speed: 400, range: 250, ability: 'ì—°ì‚¬' },
    { name: 'ë²•ì‚¬', color: '#9b59b6', speed: 1200, range: 200, ability: 'ê´‘ì—­' },
    { name: 'ë„ì ', color: '#f1c40f', speed: 1000, range: 120, ability: 'ì•½íƒˆ' }
];

function initGame() {
    document.getElementById('start-screen').classList.add('hidden');
    document.getElementById('stats').classList.remove('hidden');
    gameState = 'PLAY';
    gold = 100;
    wave = 1;
    lastTime = performance.now();
    requestAnimationFrame(gameLoop);
}

// ë³´ë“œíŒ ê·¸ë¦¬ê¸° (ê¸°íšì/ë””ìì´ë„ˆ ìš”ì²­)
function drawBoard() {
    const startX = 50, startY = 350, size = 100;
    for (let i = 0; i < 16; i++) {
        const x = startX + (i % 4) * size;
        const y = startY + Math.floor(i / 4) * size;
        
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 2;
        ctx.strokeRect(x+5, y+5, size-10, size-10);
        
        if (board[i]) {
            const u = board[i];
            ctx.fillStyle = u.color;
            ctx.beginPath();
            ctx.arc(x + size/2, y + size/2, 35, 0, Math.PI*2);
            ctx.fill();
            ctx.fillStyle = '#000';
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(u.name, x + size/2, y + size/2 + 5);
        }
    }
}

// ìœ ë‹› ì†Œí™˜ (ë²„íŠ¼ ë¡œì§)
function spawnUnit() {
    if (gold < 10) return;
    const emptySlots = board.map((v, i) => v === null ? i : null).filter(v => v !== null);
    if (emptySlots.length === 0) return;

    gold -= 10;
    const slotIdx = emptySlots[Math.floor(Math.random() * emptySlots.length)];
    const type = UNIT_TYPES[Math.floor(Math.random() * UNIT_TYPES.length)];
    board[slotIdx] = { ...type, lastShot: 0 };
    
    // ì´í™íŠ¸ ì¶”ê°€
    createExplosion(70 + (slotIdx % 4) * 100, 370 + Math.floor(slotIdx / 4) * 100, '#fff');
}

function createExplosion(x, y, color) {
    for(let i=0; i<10; i++) {
        particles.push({
            x, y, color,
            vx: (Math.random()-0.5)*10, vy: (Math.random()-0.5)*10,
            life: 1.0
        });
    }
}

function gameLoop(time) {
    if (gameState !== 'PLAY') return;
    const dt = time - lastTime;
    lastTime = time;

    ctx.clearRect(0, 0, 500, 750);

    // 1. ëª¬ìŠ¤í„° ê´€ë¦¬
    spawnTimer += dt;
    if (spawnTimer > 2000 - (wave * 50)) {
        monsters.push({ x: -20, y: 50, hp: 10 * wave, maxHp: 10 * wave, speed: 1.5 + (wave*0.1) });
        spawnTimer = 0;
    }

    monsters.forEach((m, idx) => {
        // ê²½ë¡œ ì´ë™ (ã„·ì)
        if (m.y === 50 && m.x < 430) m.x += m.speed;
        else if (m.x >= 430 && m.y < 250) m.y += m.speed;
        else if (m.y >= 250 && m.x > 50) m.x -= m.speed;
        
        // ê·¸ë¦¬ê¸°
        ctx.fillStyle = '#ff4d4d';
        ctx.fillRect(m.x-15, m.y-15, 30, 30);
        ctx.fillStyle = '#0f0';
        ctx.fillRect(m.x-15, m.y-25, (m.hp/m.maxHp)*30, 5);
    });

    // 2. ìœ ë‹› ê³µê²©
    board.forEach((u, i) => {
        if (!u) return;
        const ux = 50 + (i % 4) * 100 + 50;
        const uy = 350 + Math.floor(i / 4) * 100 + 50;
        
        u.lastShot += dt;
        if (u.lastShot > u.speed && monsters.length > 0) {
            const target = monsters[0];
            const dist = Math.hypot(target.x - ux, target.y - uy);
            
            if (dist < u.range) {
                u.lastShot = 0;
                // ê³µê²© ì„ 
                ctx.strokeStyle = u.color;
                ctx.lineWidth = 2;
                ctx.beginPath(); ctx.moveTo(ux, uy); ctx.lineTo(target.x, target.y); ctx.stroke();
                
                target.hp -= 2;
                if (target.hp <= 0) {
                    createExplosion(target.x, target.y, '#ff4d4d');
                    monsters.shift();
                    gold += 2;
                }
            }
        }
    });

    // 3. íŒŒí‹°í´ ì—…ë°ì´íŠ¸
    particles.forEach((p, i) => {
        p.x += p.vx; p.y += p.vy; p.life -= 0.02;
        ctx.globalAlpha = p.life;
        ctx.fillStyle = p.color;
        ctx.fillRect(p.x, p.y, 4, 4);
        ctx.globalAlpha = 1;
    });
    particles = particles.filter(p => p.life > 0);

    // 4. UI ë° ì›¨ì´ë¸Œ ê´€ë¦¬
    drawBoard();
    goldText.innerText = Math.floor(gold);
    waveText.innerText = wave;
    mobText.innerText = monsters.length;

    // ì†Œí™˜ ë²„íŠ¼ ì˜ì—­ (í•˜ë‹¨)
    ctx.fillStyle = '#2c3e50';
    ctx.fillRect(50, 680, 400, 50);
    ctx.fillStyle = '#fff';
    ctx.font = '20px Arial';
    ctx.textAlign = 'center';
    ctx.fillText("ìœ ë‹› ì†Œí™˜ (10 GOLD)", 250, 712);

    waveTimer += dt;
    if (waveTimer > 20000) { wave++; waveTimer = 0; }

    if (monsters.length >= 50) {
        gameState = 'OVER';
        document.getElementById('over-screen').classList.remove('hidden');
        document.getElementById('final-score').innerText = `ìµœì¢… ì›¨ì´ë¸Œ: ${wave}`;
    } else {
        requestAnimationFrame(gameLoop);
    }
}

// í´ë¦­ ì´ë²¤íŠ¸
canvas.addEventListener('click', (e) => {
    const rect = canvas.getBoundingClientRect();
    const mx = e.clientX - rect.left;
    const my = e.clientY - rect.top;

    // ì†Œí™˜ ë²„íŠ¼ í´ë¦­ ì—¬ë¶€
    if (mx > 50 && mx < 450 && my > 680 && my < 730) {
        spawnUnit();
    }
});

</script>
</body>
</html>
